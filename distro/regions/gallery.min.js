/*!
The gallery region is provided an an example of how you can easily (generally speaking) create your own regions. It
allows drag/drop of images and provides a simple implementation of a slide show with the ability to remove items. You
can use this as an example of how you could embed an entire backbone/spine app within a region.

Configuration:
  regions:gallery:
    mimeTypes: ['image/jpeg']                            # file types - overrides general uploading configuration

By default it provides the ability to have a simplistic slide show, and allows dropping images from the desktop -- which
will get uploaded (and probably processed by your server) and will then insert the returned images as slides in the
slideshow.

You can use the control panel to see thumbnails of each slide, to jump to a given slide, or to remove them. This example
also takes into account undo/redo support using the keyboard or buttons.
*/
(function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};Mercury.Region.Gallery=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.define("Mercury.Region.Gallery","gallery"),n.include(Mercury.Region.Modules.DropIndicator),n.include(Mercury.Region.Modules.DropItem),n.supported=!0,n.elements={controls:".mercury-gallery-region-controls",slides:".slides",paginator:".paginator"},n.events={"click .mercury-gallery-region-controls li":"gotoSlide"},n.prototype.skipHistoryOn=["undo","redo","next","prev","togglePlay"],n.prototype.init=function(){var e;return this.speed||(this.speed=3e3),this.index=0,(e=this.playing)==null&&(this.playing=!0),this.refresh(!0)},n.prototype.build=function(){this.$(".slides").length||this.append('<div class="slides">');if(!this.$(".paginator").length)return this.append('<div class="paginator">')},n.prototype.value=function(e){var t;return e===null||typeof e=="undefined"?(t=$("<div>").html(this.html()),t.find(".mercury-gallery-region-controls").remove(),t.find(".slide").show(),t.find(".paginator").empty(),t.html()):n.__super__.value.apply(this,arguments)},n.prototype.refresh=function(e){var t=this;e==null&&(e=!1),clearTimeout(this.timeout),this.images=this.$(".slide").hide(),this.index>this.images.length&&(this.index=1),this.index<1&&(this.index=this.images.length),this.$(".slide:nth-child("+this.index+")").show(),this.refreshPaginator(),e&&this.refreshControls();if(this.playing)return this.timeout=this.delay(this.speed,function(){return t.nextSlide()})},n.prototype.refreshPaginator=function(){return this.$paginator.html(Array(this.images.length+1).join("<span>&bull;</span>")),this.$paginator.find("span:nth-child("+this.index+")").addClass("active")},n.prototype.refreshControls=function(){var e,t,n,r,i;this.$controls.remove(),this.append('<ul class="mercury-gallery-region-controls"></ul>'),i=this.images;for(n=0,r=i.length;n<r;n++)e=i[n],t=$(e).find("img").attr("src"),this.$controls.append($('<li><img src="'+t+'"/></li>'));if(this.focused)return this.$controls.show()},n.prototype.prevSlide=function(){return this.index-=1,this.refresh()},n.prototype.nextSlide=function(){return this.index+=1,this.refresh()},n.prototype.gotoSlide=function(e){return this.index=$(e.target).closest("li").prevAll("li").length+1,this.refresh()},n.prototype.appendSlide=function(e){return this.$slides.append(e),this.refresh(!0),this.pushHistory(),this.trigger("focused")},n.prototype.removeSlide=function(){return this.$(".slide:nth-child("+this.index+")").remove(),this.refresh(!0),this.pushHistory()},n.prototype.onDropFile=function(e){var t,n=this;return t=new(Mercury[this.config("interface:uploader")])(e,{mimeTypes:this.options.mimeTypes}),t.on("uploaded",function(e){return n.focus(),n.handleAction("file",e)})},n.prototype.onFocus=function(){if(!this.previewing)return this.$controls.show()},n.prototype.onBlur=function(){return this.$controls.hide()},n.prototype.onUndo=function(){return n.__super__.onUndo.apply(this,arguments),this.refresh(!0)},n.prototype.onRedo=function(){return n.__super__.onRedo.apply(this,arguments),this.refresh(!0)},n.prototype.release=function(){return clearTimeout(this.timeout),this.html(this.value()),n.__super__.release.apply(this,arguments)},n}(Mercury.Region),Mercury.Region.Gallery.addToolbar({general:{prev:["Previous Slide"],next:["Next Slide"],remove:["Delete Slide"],togglePlay:["Play/Pause"]}}),Mercury.Region.Gallery.addAction({prev:function(){return this.prevSlide()},next:function(){return this.nextSlide()},remove:function(){return this.removeSlide()},togglePlay:function(){return this.playing=!this.playing,this.refresh()},file:function(e){if(e.isImage())return this.handleAction("image",{url:e.get("url")})},image:function(e){return this.appendSlide('<div class="slide"><img src="'+e.get("url")+'"/></div>')}}),Mercury.Region.Gallery.addContext({togglePlay:function(){return this.playing}})}).call(this);