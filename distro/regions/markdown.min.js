!function(){var e={}.hasOwnProperty,t=function(t,r){function n(){this.constructor=t}for(var i in r)e.call(r,i)&&(t[i]=r[i]);return n.prototype=r.prototype,t.prototype=new n,t.__super__=r.prototype,t};Mercury.Region.Markdown=function(e){function r(e,t){var n;return this.el=e,this.options=null!=t?t:{},this.converter=null!=(n=this.options.converter)?n:window.marked,this.converter?(this.setupConverter(),r.__super__.constructor.apply(this,arguments),void 0):(this.notify(this.t("requires a markdown converter")),!1)}return t(r,e),r.define("Mercury.Region.Markdown","markdown"),r.include(Mercury.Region.Modules.DropIndicator),r.include(Mercury.Region.Modules.DropItem),r.include(Mercury.Region.Modules.SelectionValue),r.include(Mercury.Region.Modules.FocusableTextarea),r.include(Mercury.Region.Modules.TextSelection),r.supported=!0,r.prototype.wrappers={h1:["# "," #"],h2:["## "," ##"],h3:["### "," ###"],h4:["#### "," ####"],h5:["##### "," #####"],h6:["###### "," ######"],pre:["```\n","\n```"],indentPre:["    ",""],blockquote:["> ",""],paragraph:["\n","\n"],bold:["**"],italic:["_"],underline:["<u>","</u>"],strike:["<del>","</del>"],superscript:["<sup>","</sup>"],subscript:["<sub>","</sub>"],unorderedList:["- ",""],orderedList:["1. ","",/^\d+. |$/gi],link:["[","](%s)",/^\[|\]\([^)]\)/gi],image:["![","](%s)",/^!\[|\]\([^)]\)/gi],style:['<span style="%s">',"</span>",/^(<span style="[^"]*">)|(<\/span>)$/gi],"class":['<span class="%s">',"</span>",/^(<span class="[^"]*">)|(<\/span>)$/gi]},r.prototype.blocks=["h1","h2","h3","h4","h5","h6","blockquote","unorderedList","orderedList"],r.prototype.setupConverter=function(){return this.converter.setOptions(this.options)},r.prototype.convertedValue=function(){return this.converter(this.value())},r.prototype.toJSON=function(e){var t;return null==e&&(e=!1),t=r.__super__.toJSON.apply(this,arguments),e?(t.converted=this.convertedValue(),t):t},r.prototype.onDropFile=function(e){var t,r=this;return t=new(Mercury[this.config("interface:uploader")])(e,{mimeTypes:this.options.mimeTypes}),t.on("uploaded",function(e){return r.focus(),r.handleAction("file",e)})},r.prototype.onReturnKey=function(e){var t,r,n,i;return t=this.expandSelectionToLines(this.getSelection()),i=t.text,i.match(/^- /)?(this.prevent(e),i.match(/^- ./)?this.replaceSelection("\n- "):this.replaceSelectedLine(t,"\n")):(r=i.match(/^(\d+)\. /))?(this.prevent(e),n=parseInt(r[1],10)+1,i.match(/^\d+\. ./)?this.replaceSelection("\n"+n+". "):this.replaceSelectedLine(t,"\n")):(r=i.match(/^(> )+/g))?(this.prevent(e),i.match(/^(> )+./g)?this.replaceSelection("\n"+r[0]):this.replaceSelectedLine(t,"\n")):(r=i.match(/^\s{4}/g))?(this.prevent(e),i.match(/^\s{4}./)?this.replaceSelection("\n    "):this.replaceSelectedLine(t,"\n")):void 0},r}(Mercury.Region),Mercury.Region.Markdown.addToolbar({defined:{style:["Style",{plugin:"styles"}]},headings:{h1:["Heading 1",{action:["block","h1"]}],h2:["Heading 2",{action:["block","h2"]}],h3:["Heading 3",{action:["block","h3"]}],h4:["Heading 4",{action:["block","h4"]}],h5:["Heading 5",{action:["block","h5"]}],h6:["Heading 6",{action:["block","h6"]}],removeHeading:["No Heading",{action:["block",null]}]},blocks:{unorderedList:["Unordered List"],orderedList:["Numbered List"],blockquote:["Blockquote",{action:["block","blockquote"]}],sep:" ",pre:["Formatted",{action:["block","pre"]}]},decoration:{bold:["Bold"],italic:["Italicize"],strike:["Strikethrough"],underline:["Underline"]},script:{subscript:["Subscript"],superscript:["Superscript"]},indent:{indent:["Increase Indentation"],outdent:["Decrease Indentation"]},rules:{rule:["Horizontal Rule",{title:"Insert a horizontal rule"}]}}),Mercury.Region.Markdown.addAction({bold:function(){return this.toggleWrapSelectedWords("bold")},italic:function(){return this.toggleWrapSelectedWords("italic")},underline:function(){return this.toggleWrapSelectedWords("underline")},strike:function(){return this.toggleWrapSelectedWords("strike")},subscript:function(){return this.toggleWrapSelectedWords("subscript")},superscript:function(){return this.toggleWrapSelectedWords("superscript")},rule:function(){return this.replaceSelectionWithParagraph("- - -")},indent:function(){return this.wrapSelectedParagraphs("blockquote")},outdent:function(){return this.unwrapSelectedParagraphs("blockquote")},orderedList:function(){var e,t,r,n;for(n=["blockquote","unorderedList"],t=0,r=n.length;r>t;t++)e=n[t],this.unwrapSelectedParagraphs(e);return this.unwrapSelectedParagraphs("orderedList")?void 0:this.wrapSelectedParagraphs("orderedList")},unorderedList:function(){var e,t,r,n;for(n=["blockquote","orderedList"],t=0,r=n.length;r>t;t++)e=n[t],this.unwrapSelectedParagraphs(e);return this.unwrapSelectedParagraphs("unorderedList")?void 0:this.wrapSelectedParagraphs("unorderedList")},style:function(e){var t;return t=(e||"").indexOf(":")>-1?"style":"class",this.unwrapSelectedWords("style"===t?"class":"style"),this.toggleWrapSelectedWords(this.processWrapper(t,[e]))},html:function(e){return this.replaceSelection(e=(e.get&&e.get(0)||e).outerHTML||e)},block:function(e){var t,r,n,i,o,s,c;if("blockquote"===e){for(s=["orderedList","unorderedList"],r=0,i=s.length;i>r;r++)t=s[r],this.unwrapSelectedParagraphs(t);return this.unwrapSelectedParagraphs("blockquote")||this.handleAction("indent"),void 0}if(("pre"===e||"paragraph"===e)&&(this.unwrapSelectedParagraphs("pre",{all:!0}),this.wrappers[e]))return this.wrapSelectedParagraphs(e,{all:!0});for(c=this.blocks,n=0,o=c.length;o>n;n++)t=c[n],this.unwrapSelectedLines(t);return this.wrappers[e]?this.wrapSelectedLines(e):void 0},character:function(e){return this.handleAction("html",e)},table:function(e){return this.handleAction("html",e.asHtml())},file:function(e){var t;return t=e.isImage()?"image":"link",this.handleAction(t,{url:e.get("url"),text:e.get("name")})},link:function(e){return this.replaceSelection(e.asMarkdown())},image:function(e){var t;return t=e.get("text"),this.wrapSelected(this.processWrapper("image",[e.get("url"),t]),{text:t,select:"end"})}}),Mercury.Region.Markdown.addContext({h1:function(){return this.isWithinLineToken("h1")},h2:function(){return this.isWithinLineToken("h2")},h3:function(){return this.isWithinLineToken("h3")},h4:function(){return this.isWithinLineToken("h4")},h5:function(){return this.isWithinLineToken("h5")},h6:function(){return this.isWithinLineToken("h6")},blockquote:function(){return this.firstLineMatches(/^> /)},pre:function(){return this.paragraphMatches(/^```|```$/)||this.firstLineMatches(/^(> )*\s{4}/)},bold:function(){return this.isWithinToken("bold")},italic:function(){return this.isWithinToken("italic")},underline:function(){return this.isWithinToken("underline")},strike:function(){return this.isWithinToken("strike")},subscript:function(){return this.isWithinToken("subscript")},superscript:function(){return this.isWithinToken("superscript")},unorderedList:function(){return this.firstLineMatches(/^(> )*- /)},orderedList:function(){return this.firstLineMatches(/^(> )*\d+\./)}})}.call(this);