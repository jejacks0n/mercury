/*!
Mercury Editor is a Coffeescript and jQuery based WYSIWYG editor released under the MIT License.
Documentation and other useful information can be found at https://github.com/jejacks0n/mercury

Copyright (c) 2013 Jeremy Jackson
*/


(function() {
  this.Mercury || (this.Mercury = {});

  Mercury.configuration = {
    logging: {
      enabled: false,
      notifier: 'console'
    },
    localization: {
      enabled: false,
      preferred: 'swedish_chef-BORK'
    },
    uploading: {
      enabled: true,
      saveUrl: '/mercury/uploads',
      saveName: 'file',
      mimeTypes: ['image/jpeg', 'image/gif', 'image/png'],
      maxSize: 5242880
    },
    saving: {
      enabled: true,
      url: '/mercury/save',
      method: 'POST',
      contentType: 'application/json'
    },
    templates: {
      enabled: true,
      prefixUrl: '/mercury/templates'
    },
    "interface": {
      enabled: true,
      "class": 'FrameInterface',
      toolbar: 'Toolbar',
      statusbar: 'Statusbar',
      uploader: 'Uploader',
      silent: false,
      shadowed: false,
      maskable: false,
      style: false,
      floating: false,
      floatWidth: false,
      floatDrag: true,
      nohijack: ['mercury-ignored']
    },
    toolbars: {
      primary: {
        save: [
          'Save', {
            title: 'Save this page',
            event: 'save',
            global: true
          }
        ],
        preview: [
          'Preview', {
            title: 'Preview this page',
            mode: 'preview',
            global: true
          }
        ],
        sep1: ' ',
        undo: [
          'Undo', {
            title: 'Undo your last action'
          }
        ],
        redo: [
          'Redo', {
            title: 'Redo your last action'
          }
        ],
        sep2: '-',
        link: [
          'Link', {
            title: 'Insert Link',
            plugin: 'link'
          }
        ],
        file: [
          'Media', {
            title: 'Insert Media and Files (images, videos, etc.)',
            plugin: 'media'
          }
        ],
        table: [
          'Table', {
            title: 'Insert Table',
            plugin: 'table'
          }
        ],
        character: [
          'Character', {
            title: 'Special Characters',
            plugin: 'character'
          }
        ],
        snippets: [
          'Snippets', {
            title: 'Snippet Panel',
            plugin: 'snippets'
          }
        ],
        sep3: ' ',
        history: [
          'History', {
            title: 'Page Version History',
            plugin: 'history'
          }
        ],
        notes: [
          'Notes', {
            title: 'Page Notes',
            plugin: 'notes'
          }
        ]
      }
    },
    regions: {
      attribute: 'data-mercury',
      options: 'data-region-options',
      identifier: 'id',
      gallery: {
        mimeTypes: ['image/jpeg']
      },
      html: {
        mimeTypes: false
      },
      image: {
        mimeTypes: ['image/jpeg']
      },
      markdown: {
        autoSize: true,
        mimeTypes: false,
        wrapping: true,
        sanitize: false,
        breaks: true
      },
      plain: {
        allowActs: true,
        pasting: true,
        newlines: false
      },
      text: {
        autoSize: true,
        wrapping: true
      }
    }
  };

}).call(this);
!function(){this.JST||(this.JST={}),this.Mercury||(this.Mercury={})}.call(this),function(){JST["/mercury/templates/lightview"]=function(){return'<div class="mercury-lightview-overlay"></div>\n<div class="mercury-lightview-dialog">\n  <div class="mercury-lightview-dialog-positioner">\n    <div class="mercury-lightview-dialog-title"><em>&times;</em><span></span></div>\n    <div class="mercury-lightview-loading-indicator"></div>\n    <div class="mercury-lightview-dialog-content-container">\n      <div class="mercury-lightview-dialog-content">\n      </div>\n    </div>\n  </div>\n</div>'}}.call(this),function(){JST["/mercury/templates/modal"]=function(){return'<div class="mercury-modal-overlay"></div>\n<div class="mercury-modal-dialog">\n  <div class="mercury-modal-dialog-positioner">\n    <div class="mercury-modal-dialog-title"><em>&times;</em><span></span></div>\n    <div class="mercury-modal-loading-indicator"></div>\n    <div class="mercury-modal-dialog-content-container">\n      <div class="mercury-modal-dialog-content">\n      </div>\n    </div>\n  </div>\n</div>'}}.call(this),function(){JST["/mercury/templates/panel"]=function(){return'<div class="mercury-panel-title"><em>&times;</em><span>Test Panel</span></div>\n<div class="mercury-panel-loading-indicator"></div>\n  <div class="mercury-panel-content-container">\n    <div class="mercury-panel-content">\n      content\n    </div>\n  </div>\n</div>'}}.call(this),function(){JST["/mercury/templates/statusbar"]=function(){return'<div class="mercury-statusbar-about">\n  <a href="https://github.com/jejacks0n/mercury" target="_blank">Mercury Editor v'+Mercury.version+'</a>\n</div>\n<div class="mercury-statusbar-path"></div>'}}.call(this),function(){JST["/mercury/templates/uploader"]=function(){return'<div class="mercury-uploader-dialog">\n  <div class="mercury-uploader-preview"><b><img/></b></div>\n  <div class="mercury-uploader-details"></div>\n  <div class="mercury-uploader-progress">\n    <span></span>\n    <div class="mercury-uploader-indicator"><div><b>0%</b></div></div>\n  </div>\n</div>'}}.call(this),function(){Number.prototype.toHex=function(){var t;return t=this.toString(16).toUpperCase(),t[1]?t:"0"+t},Number.prototype.toBytes=function(){var t,e,i;for(i=[""," kb"," Mb"," Gb"," Tb"," Pb"," Eb"],t=parseInt(this),e=0;t>1023;)t/=1024,e+=1;return e?""+t.toFixed(2)+i[e]:""+t+" bytes"}}.call(this),function(){var t={}.hasOwnProperty;Object.toParams=function(e){var i,n;return i=[],(n=function(e,r){var o,s,a,l,u;u=[];for(a in e)t.call(e,a)&&(l=e[a],l instanceof Array?u.push(function(){var t,e,i;for(i=[],s=t=0,e=l.length;e>t;s=++t)o=l[s],i.push(n(o,null!=r?""+r+"["+a+"][]":""+a+"[]"));return i}()):l instanceof Object?u.push(n(l,null!=r?r+="["+a+"]":r=a)):u.push(i.push(null!=r?""+r+"["+a+"]="+l:""+a+"="+l)));return u})(e,null),i.join("&")}}.call(this),function(){String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")},String.prototype.toCamelCase=function(t){return null==t&&(t=!1),t?this.toTitleCase().replace(/([\-|_][a-z])/g,function(t){return t.toUpperCase().replace(/[\-|_]/,"")}):this.replace(/([\-|_][a-z])/g,function(t){return t.toUpperCase().replace(/[\-|_]/,"")})},String.prototype.toDash=function(){return this.replace(/([A-Z])/g,function(t){return"-"+t.toLowerCase()}).replace(/^-+|-+$/g,"")},String.prototype.toUnderscore=function(){return this.replace(/([A-Z])/g,function(t){return"_"+t.toLowerCase()}).replace(/^_+|_+$/g,"")},String.prototype.toTitleCase=function(){return this[0].toUpperCase()+this.slice(1)},String.prototype.toHex=function(){return"#"===this[0]?this.toString():this.replace(/rgb(a)?\(([0-9|%]+)[\s|,]?\s?([0-9|%]+)[\s|,]?\s?([0-9|%]+)[\s|,]?\s?([0-9|.|%]+\s?)?\)/gi,function(t,e,i,n,r){return"#"+parseInt(i).toHex()+parseInt(n).toHex()+parseInt(r).toHex()})},String.prototype.regExpEscape=function(){var t,e;return e=["/",".","*","+","?","|","(",")","[","]","{","}","\\"],t=new RegExp("(\\"+e.join("|\\")+")","g"),this.replace(t,"\\$1")},String.prototype.printf=function(){var t,e,i,n,r,o,s,a,l,u;for(i=this.split("%"),a=i[0],s=/^([sdf])([\s\S%]*)$/,r=0,n=l=0,u=i.length;u>l;n=++l)if(e=i[n],o=s.exec(e),0!==n&&o&&null!==arguments[n]){switch(t=arguments[n-1-r],o[1]){case"s":a+=t;break;case"d":case"i":a+=parseInt(t.toString(),10);break;case"f":a+=parseFloat(t)}a+=o[2]}else n>1&&(r+=2,a+="%"+e);return a}}.call(this),function(){Mercury.TableEditor=function(){function t(t,e){this.table=t,this.cellContent=null!=e?e:"",this.table&&this.load(this.table)}return t.prototype.load=function(t,e){return this.table=t,e&&(this.cellContent=e),this.setCell(),this.row=this.cell.parent("tr"),this.columnCount=this.getColumnCount(),this.rowCount=this.getRowCount()},t.prototype.setCell=function(t){return this.cell=null!=t?t:null,this.table.find(".selected").removeAttr("class"),this.cell&&(this.cell=this.cell.closest("td, th")),this.cell||(this.cell=this.table.find("th, td").first()),this.cell.addClass("selected")},t.prototype.asHtml=function(t){var e;return null==t&&(t=""),e=this.table.clone(),e.find(".selected").removeAttr("class"),e.find("td, th").html(t),$("<div>").html(e).html().replace(/^\s+|\n/gm,"").replace(/(<\/.*?>|<table.*?>|<tbody>|<tr>)/g,"$1\n")},t.prototype.addColumnBefore=function(){return this.addColumn("before")},t.prototype.addColumnAfter=function(){return this.addColumn("after")},t.prototype.addColumn=function(t){var e,i,n,r,o,s,a,l,u,c,h;for(null==t&&(t="after"),a=this.cellSignatureFor(this.cell),c=this.table.find("tr"),h=[],e=l=0,u=c.length;u>l;e=++l)s=c[e],n="after"===t?{right:a.right}:{left:a.left},(r=this.findCellByOptionsFor(s,n))?(o=$("<"+r.cell.get(0).tagName+">").html(this.cellContent),this.setRowspanFor(o,r.height),"before"===t?r.cell.before(o):r.cell.after(o),h.push(e+=r.height-1)):(i=this.findCellByIntersectionFor(s,a))?h.push(this.setColspanFor(i.cell,i.width+1)):h.push(void 0);return h},t.prototype.removeColumn=function(){var t,e,i,n,r,o,s,a,l,u,c,h,p,d,f,g;if(a=this.cellSignatureFor(this.cell),!(a.width>1)){for(o=[],t=[],f=this.table.find("tr"),i=l=0,h=f.length;h>l;i=++l)s=f[i],(r=this.findCellByOptionsFor(s,{left:a.left,width:a.width}))?(o.push(r.cell),i+=r.height-1):(n=this.findCellByIntersectionFor(s,a))&&t.push(n.cell);for(u=0,p=o.length;p>u;u++)e=o[u],$(e).remove();for(g=[],c=0,d=t.length;d>c;c++)e=t[c],g.push(this.setColspanFor(e,this.colspanFor(e)-1));return g}},t.prototype.addRowBefore=function(){return this.addRow("before")},t.prototype.addRowAfter=function(){return this.addRow("after")},t.prototype.addRow=function(t){var e,i,n,r,o,s,a,l,u,c,h,p,d,f,g,y,m;for(null==t&&(t="after"),o=$("<tr>"),(l=this.rowspanFor(this.cell))>1&&"after"===t&&(this.row=$(this.row.nextAll("tr")[l-2])),i=0,g=this.row.find("th, td"),u=0,p=g.length;p>u;u++)e=g[u],n=this.colspanFor(e),r=$("<"+e.tagName+">").html(this.cellContent),this.setColspanFor(r,n),i+=n,(l=this.rowspanFor(e))>1&&"after"===t?this.setRowspanFor(e,l+1):o.append(r);if(i<this.columnCount)for(a=0,y=this.row.prevAll("tr"),c=0,d=y.length;d>c;c++)for(s=y[c],a+=1,m=$(s).find("td[rowspan], th[rowspan]"),h=0,f=m.length;f>h;h++)e=m[h],l=this.rowspanFor(e),l-1>=a&&"before"===t?this.setRowspanFor(e,l+1):l-1>=a&&"after"===t&&(l-1===a?(r=$("<"+e.tagName+">").html(this.cellContent),this.setColspanFor(r,this.colspanFor(e)),o.append(r)):this.setRowspanFor(e,l+1));return"before"===t?this.row.before(o):this.row.after(o)},t.prototype.removeRow=function(){var t,e,i,n,r,o,s,a,l,u,c,h,p,d,f,g,y,m,v,b,w,_,M,S;for(l=!0,o=0,r=0,b=this.row.find("td, th"),c=0,f=b.length;f>c;c++)e=b[c],a=this.rowspanFor(e),o&&a!==o&&(l=!1),(r>a||!r)&&(r=a),o=a;if(l||!(this.rowspanFor(this.cell)>r)){if(r>1)for(i=h=0,w=r-2;w>=0?w>=h:h>=w;i=w>=0?++h:--h)$(this.row.nextAll("tr")[i]).remove();for(_=this.row.find("td[rowspan], th[rowspan]"),p=0,g=_.length;g>p;p++)e=_[p],u=this.cellSignatureFor(e),u.height!==r&&(n=this.findCellByOptionsFor(this.row.nextAll("tr")[r-1],{left:u.left,forceAdjacent:!0}))&&(this.setRowspanFor(e,this.rowspanFor(e)-this.rowspanFor(this.cell)),"before"===n.direction?n.cell.before($(e).clone()):n.cell.after($(e).clone()));if(this.columnsFor(this.row.find("td, th"))<this.columnCount)for(s=0,M=this.row.prevAll("tr"),d=0,y=M.length;y>d;d++)for(t=M[d],s+=1,S=$(t).find("td[rowspan], th[rowspan]"),v=0,m=S.length;m>v;v++)e=S[v],a=this.rowspanFor(e),a>s&&this.setRowspanFor(e,a-this.rowspanFor(this.cell));return this.row.remove()}},t.prototype.increaseColspan=function(){var t;return t=this.cell.next("td, th"),!t.length||this.rowspanFor(t)!==this.rowspanFor(this.cell)||this.cellIndexFor(t)>this.cellIndexFor(this.cell)+this.colspanFor(this.cell)?void 0:(this.setColspanFor(this.cell,this.colspanFor(this.cell)+this.colspanFor(t)),t.remove())},t.prototype.decreaseColspan=function(){var t;if(1!==this.colspanFor(this.cell))return this.setColspanFor(this.cell,this.colspanFor(this.cell)-1),t=$("<"+this.cell.get(0).tagName+">").html(this.cellContent),this.setRowspanFor(t,this.rowspanFor(this.cell)),this.cell.after(t)},t.prototype.increaseRowspan=function(){var t,e,i;return i=this.cellSignatureFor(this.cell),e=this.row.nextAll("tr")[i.height-1],e&&(t=this.findCellByOptionsFor(e,{left:i.left,width:i.width}))?(this.setRowspanFor(this.cell,i.height+t.height),t.cell.remove()):void 0},t.prototype.decreaseRowspan=function(){var t,e,i,n;return n=this.cellSignatureFor(this.cell),1!==n.height?(i=this.row.nextAll("tr")[n.height-2],(t=this.findCellByOptionsFor(i,{left:n.left,forceAdjacent:!0}))?(e=$("<"+this.cell.get(0).tagName+">").html(this.cellContent),this.setColspanFor(e,this.colspanFor(this.cell)),this.setRowspanFor(this.cell,n.height-1),"before"===t.direction?t.cell.before(e):t.cell.after(e)):void 0):void 0},t.prototype.getColumnCount=function(){return this.columnsFor(this.table.find("thead tr:first-child, tbody tr:first-child, tfoot tr:first-child").first().find("td, th"))},t.prototype.getRowCount=function(){return this.table.find("tr").length},t.prototype.cellIndexFor=function(t){var e,i,n,r,o,s,a,l,u,c,h,p;if(t=$(t),o=t.parent("tr"),n=this.columnsFor(o.find("td, th")),r=this.columnsFor(t.prevAll("td, th")),n<this.columnCount)for(s=0,h=o.prevAll("tr"),a=0,u=h.length;u>a;a++)for(i=h[a],s+=1,p=$(i).find("td[rowspan], th[rowspan]"),l=0,c=p.length;c>l;l++)e=p[l],this.rowspanFor(e)>s&&this.cellIndexFor(e)<=r&&(r+=this.colspanFor(e));return r},t.prototype.cellSignatureFor=function(t){var e;return e={cell:$(t)},e.left=this.cellIndexFor(t),e.width=this.colspanFor(t),e.height=this.rowspanFor(t),e.right=e.left+e.width,e},t.prototype.findCellByOptionsFor=function(t,e){var i,n,r,o,s,a;for(a=$(t).find("td, th"),o=0,s=a.length;s>o;o++){if(i=a[o],r=this.cellSignatureFor(i),"undefined"!=typeof e.right&&r.right===e.right)return r;if("undefined"!=typeof e.left)if(e.width){if(r.left===e.left&&r.width===e.width)return r}else if(e.forceAdjacent){if(e.forceAdjacent&&r.left>e.left)return n=$(i).prev("td, th"),n.length?(r=this.cellSignatureFor(n),r.direction="after"):r.direction="before",r}else if(r.left===e.left)return r}return e.forceAdjacent?(r.direction="after",r):null},t.prototype.findCellByIntersectionFor=function(t,e){var i,n,r,o,s;for(s=$(t).find("td, th"),r=0,o=s.length;o>r;r++)if(i=s[r],n=this.cellSignatureFor(i),n.right-e.left>=0&&n.right>e.left)return n;return null},t.prototype.columnsFor=function(t){var e,i,n,r;for(i=0,n=0,r=t.length;r>n;n++)e=t[n],i+=this.colspanFor(e);return i},t.prototype.colspanFor=function(t){return parseInt($(t).attr("colspan"),10)||1},t.prototype.rowspanFor=function(t){return parseInt($(t).attr("rowspan"),10)||1},t.prototype.setColspanFor=function(t,e){return $(t).attr("colspan",e>1?e:null)},t.prototype.setRowspanFor=function(t,e){return $(t).attr("rowspan",e>1?e:null)},t}()}.call(this),function(){var t=[].slice;(this.Mercury||(this.Mercury={})).I18n={__locales__:{},define:function(t,e){return this.__locales__[t]=e},locale:function(){var t,e,i,n;return this.__determined__?this.__determined__:(null!=(i=Mercury.configuration.localization)?i.enabled:void 0)?(n=this.detectLocale(),e=n[0],t=n[1],e=this.__locales__[e],t=e&&t?e["_"+t.toUpperCase()+"_"]:!1,this.__determined__=[e||{},t||{}]):[{},{}]},detectLocale:function(){var t,e,i;return this.__detected__?this.__detected__:(t=(this.clientLocale()||(null!=(e=Mercury.configuration.localization)?e.preferred:void 0)).split("-"),this.__locales__[t[0]]||(t=((null!=(i=Mercury.configuration.localization)?i.preferred:void 0)||"en-US").split("-")),this.__detected__=t)},t:function(){var e,i,n,r,o,s;return i=arguments[0],e=2<=arguments.length?t.call(arguments,1):[],s=Mercury.I18n.locale(),r=s[0],n=s[1],o=(n[i]||r[i]||i||"").toString(),e.length?o.printf.apply(o,e):o},clientLocale:function(){var t;return null!=(t=navigator.language)?t.toString():void 0}},Mercury.I18n.Module={t:Mercury.I18n.t}}.call(this),function(){var t=[].slice;(this.Mercury||(this.Mercury={})).Logger={logPrefix:"Mercury:",log:function(){var e,i;return e=1<=arguments.length?t.call(arguments,0):[],(null!=(i=Mercury.configuration.logging)?i.enabled:void 0)?((this.logPrefix||this.constructor.logPrefix)&&e.unshift(this.logPrefix||this.constructor.logPrefix),"undefined"!=typeof console&&null!==console?"function"==typeof console.debug?console.debug.apply(console,e):void 0:void 0):void 0},notify:function(t){var e,i,n;if((this.logPrefix||this.constructor.logPrefix)&&(t=""+(this.constructor.logPrefix||this.logPrefix)+" "+t),"console"===(null!=(i=Mercury.configuration.logging)?i.notifier:void 0))try{return console.error(t)}catch(r){e=r}else if("alert"===(null!=(n=Mercury.configuration.logging)?n.notifier:void 0))return alert(t);throw new Error(t)}}}.call(this),function(){Mercury.Module=function(){function t(){this.__handlers__=$.extend(!0,{},this.__handlers__),"function"==typeof this.init&&this.init.apply(this,arguments),"function"==typeof this.trigger&&this.trigger("init")}var e;return e=["included","extended","private"],t.extend=function(t){var i,n,r,o;if(!t)throw new Error("extend expects an object");n=t.Module||t;for(r in n)i=n[r],e.indexOf(r)>-1||(this[r]=i);return null!=(o=n.extended)?o.apply(this):void 0},t.include=function(t){var i,n,r,o;if(!t)throw new Error("include expects an object");n=t.Module||t;for(r in n)i=n[r],e.indexOf(r)>-1||(this.prototype[r]=i);return null!=(o=n.included)?o.apply(this.prototype):void 0},t.proxy=function(t){var e=this;return function(){return t.apply(e,arguments)}},t.prototype.proxy=function(t){var e=this;return function(){return t.apply(e,arguments)}},t}()}.call(this),function(){var t={}.hasOwnProperty,e=function(e,i){function n(){this.constructor=e}for(var r in i)t.call(i,r)&&(e[r]=i[r]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e},i=[].slice;Mercury.Action=function(t){function n(){var t;t=1<=arguments.length?i.call(arguments,0):[],this.name||(this.name=t.shift()),this.attributes=t.pop()||{},n.__super__.constructor.apply(this,arguments)}return e(n,t),n.include(Mercury.I18n),n.include(Mercury.Logger),n.logPrefix="Mercury.Action:",n.create=function(t,e){var i;return null==e&&(e={}),e instanceof Mercury.Model?e:(i=t.toCamelCase(!0),Mercury.Action[i]?new Mercury.Action[i](e):new Mercury.Action(t,e))},n.prototype.get=function(t){return this.attributes[t]},n.prototype.set=function(t,e){var i,n;i={},"object"==typeof t?i=t:i[t]=e,n=[];for(t in i)e=i[t],n.push(this.attributes[t]=e);return n},n}(Mercury.Module)}.call(this),function(){var t=[].slice;(this.Mercury||(this.Mercury={})).Config={get:function(t){var e,i,n,r,o,s;e=Mercury.configuration||(Mercury.configuration={});try{if(t)for(s=t.split(":"),r=0,o=s.length;o>r;r++)n=s[r],e=e[n]}catch(a){return i=a,void 0}return e},set:function(){var e,i,n,r,o,s,a;if(e=1<=arguments.length?t.call(arguments,0):[],s=e.shift(),a=e.pop(),n=e.pop(),"object"==typeof s)return Mercury.configuration=s;for(i=Mercury.configuration||(Mercury.configuration={}),o=s.split(":"),r=o.shift();r;){if(0===o.length)return i[r]=n&&"object"==typeof i[r]?$.extend(!0,i[r],a):a,i[r];i=i[r]?i[r]:i[r]={},r=o.shift()}}},Mercury.Config.Module={config:Mercury.Config.get}}.call(this),function(){var t=[].slice;(this.Mercury||(this.Mercury={})).Events={on:function(t,e){var i,n,r,o;for(t=t.split(" "),i=this.__handlers__||(this.__handlers__={}),r=0,o=t.length;o>r;r++)n=t[r],i[n]||(i[n]=[]),i[n].push(e);return this},one:function(t,e){var i;return i=function(){return this.off(t,i),e.apply(this,arguments)},this.on(t,i)},off:function(t,e){var i,n,r,o,s,a,l,u,c,h;if(!t)return this.__handlers__={},this;for(c=t.split(" "),s=0,l=c.length;l>s;s++)if(o=c[s],r=null!=(h=this.__handlers__)?h[o]:void 0)if(e){for(n=a=0,u=r.length;u>a;n=++a)if(i=r[n],i===e){r=r.slice(),r.splice(n,1),this.__handlers__[o]=r;break}}else delete this.__handlers__[o];return this},trigger:function(){var e,i,n,r,o,s,a;if(e=1<=arguments.length?t.call(arguments,0):[],i=e.shift(),"function"==typeof this.log&&this.log(i,e),!(r=null!=(a=this.__handlers__)?a[i]:void 0))return!1;for(o=0,s=r.length;s>o&&(n=r[o],n.apply(this,e)!==!1);o++);return!0}}}.call(this),function(){(this.Mercury||(this.Mercury={})).Stack={included:function(){return this.stackPosition=0,this.maxStackLength=200,this.stack=[]},pushStack:function(t){return null===t||this.stackEquality(t)?void 0:(this.stack=this.stack.slice(0,this.stackPosition+1),this.stack.push(t),this.stack.length>this.maxStackLength&&this.stack.shift(),this.stackPosition=this.stack.length-1)},stackEquality:function(t){return JSON.stringify(this.stack[this.stackPosition])===JSON.stringify(t)},undoStack:function(){return this.stackPosition<1?null:(this.stackPosition-=1,this.stack[this.stackPosition])},redoStack:function(){return this.stackPosition>=this.stack.length-1?null:(this.stackPosition+=1,this.stack[this.stackPosition])},clearStack:function(){return this.stackPosition=0,this.stack=[]}}}.call(this),function(){var t={}.hasOwnProperty,e=function(e,i){function n(){this.constructor=e}for(var r in i)t.call(i,r)&&(e[r]=i[r]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};Mercury.Model=function(t){function i(t){var e;null==t&&(t={}),this.attributes={},this.errors={},this.set(t),this.cid||(this.cid=this.constructor.uid("c")),(e=this.constructor).records||(e.records={}),this.constructor.records[this.cid]=this,i.__super__.constructor.apply(this,arguments)}return e(i,t),i.extend(Mercury.Config),i.extend(Mercury.Events),i.include(Mercury.Config),i.include(Mercury.Events),i.include(Mercury.I18n),i.include(Mercury.Logger),i.include(Mercury.Stack),i.logPrefix="Mercury.Model:",i.idCounter=1,i.define=function(t,e){return this.className=t,this.urlPrefix=e,this.logPrefix=this.prototype.logPrefix=""+this.className+":",this.records={},this.off(),this},i.url=function(){return this.urlPrefix},i.find=function(t){var e;if(e=this.records[t],!e&&(""+t).match(/^\d+/))return this.find("c"+t);if(!e)throw new Error(""+this.className+" found no records with the ID '"+t+"'");return e},i.all=function(){var t,e,i,n;i=this.records,n=[];for(t in i)e=i[t],n.push(e);return n},i.count=function(){return this.all().length},i.toJSON=function(){return this.all()},i.contains=function(t){var e;try{return this.find(t)}catch(i){return e=i,!1}},i.uid=function(t){var e;return null==t&&(t=""),e=t+this.idCounter++,this.contains(e)&&(e=this.uid(t)),e},i.prototype.url=function(){return this.constructor.url(this)},i.prototype.validate=function(){},i.prototype.save=function(t){var e,i=this;return null==t&&(t={}),this.isValid()?(e={method:this.isNew()?"POST":"PUT",url:this.url(),dataType:"json",contentType:"application/json; charset=utf-8",cache:!1,data:this.toJSON(),success:function(t){return"object"==typeof t&&(i.id=t.id,i.id&&(i.constructor.records[i.id]=i),i.set(t),i.trigger("save",t)),"function"==typeof i.saveSuccess?i.saveSuccess(t):void 0},error:function(e){return i.trigger("error",e,t),i.notify(i.t("Unable to process response: %s",e.status)),"function"==typeof i.saveError?i.saveError.apply(i,arguments):void 0}},t=$.extend(e,t),t.dataType&&"string"!=typeof t.data&&(t.data=JSON.stringify(t.data)),$.ajax(t)):!1},i.prototype.toJSON=function(){return $.extend(!0,{},this.attributes)},i.prototype.isNew=function(){return!this.exists()},i.prototype.isValid=function(){var t,e,i;this.errors={},this.validate(),i=this.errors;for(t in i)return e=i[t],!1;return!0},i.prototype.addError=function(t,e){var i;return((i=this.errors)[t]||(i[t]=[])).push(e)},i.prototype.errorMessages=function(){var t,e,i,n;if(this.isValid())return!1;e=[],n=this.errors;for(t in n)i=n[t],e.push(""+i.join(", "));return e.join("\n")},i.prototype.get=function(t){return this.attributes[t]},i.prototype.set=function(t,e){var i,n;i={},"object"==typeof t?i=t:i[t]=e,this.pushStack(this.toJSON()),n=[];for(t in i)e=i[t],n.push(this.attributes[t]=e);return n},i.prototype.exists=function(){return this.id&&this.id in this.constructor.records},i}(Mercury.Module)}.call(this),function(){var t,e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var r in i)e.call(i,r)&&(t[r]=i[r]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t},n=[].slice;t={},Mercury.Plugin=function(e){function r(t){var e,i,n;this.options=null!=t?t:{},this.configuration=this.options.config||{},n=this.options;for(e in n)i=n[e],"config"!==e&&(this[e]=i);if(!this.name)throw new Error("must provide a name for plugins");this.actionsArray=[],this.actions||(this.actions={}),this.events=$.extend({},this.constructor.events,this.events),this.delegateEvents(this.events),this.appendActions(this.actions),r.__super__.constructor.apply(this,arguments)}return i(r,e),r.include(Mercury.Config),r.include(Mercury.Events),r.include(Mercury.I18n),r.include(Mercury.Logger),r.logPrefix="Mercury.Plugin:",r.events={"mercury:region:focus":"onRegionFocus"},r.register=function(t,e){return e.name=t,new Mercury.Plugin.Definition(e)},r.get=function(e,i){var n;if(null==i&&(i=!1),n=t[e],!n)throw new Error("unable to locate the "+e+" plugin");return i?new Mercury.Plugin(n.signature()):n},r.all=function(){return t},r.unregister=function(e){var i;if(i=t[e],!i)throw new Error("unable to locate the "+e+" plugin");return delete t[e]},r.prototype.buttonRegistered=function(t){var e=this;return this.button=t,this.configuration=$.extend({},this.configuration,this.button.get("settings")),this.button.on("click",function(){return e.onButtonClick()}),this.prependButtonAction&&(this.context=this.button.get("actionName"),this.prependAction(this.context,this.prependButtonAction)),"function"==typeof this.registerButton?this.registerButton():void 0},r.prototype.regionSupported=function(t){var e,i,n,r;for(this.region=t,r=this.actionsArray,i=0,n=r.length;n>i;i++)if(e=r[i],this.region.hasAction(e[0]))return"function"==typeof this.regionContext&&this.regionContext(),!0;return!1},r.prototype.triggerAction=function(){var t,e,i,r,o;if(e=1<=arguments.length?n.call(arguments,0):[],!this.region)return!1;for(o=this.actionsArray,i=0,r=o.length;r>i;i++)if(t=o[i],this.region.hasAction(t[0]))return e.unshift(t[0]),Mercury.trigger("focus"),t[1].apply(this,e),!0;return!1},r.prototype.config=function(t){var e,i,n,r,o,s;e=this.configuration||(this.configuration={});try{for(s=t.split(":"),r=0,o=s.length;o>r;r++)n=s[r],e=e[n]}catch(a){return i=a,Mercury.Config.get(t)}return"undefined"==typeof e?Mercury.Config.get(t):e},r.prototype.configure=function(){var t,e,i,r,o,s,a;if(t=1<=arguments.length?n.call(arguments,0):[],s=t.shift(),a=t.pop(),i=t.pop(),"object"==typeof s)return this.configuration=s;for(e=this.configuration||(this.configuration={}),o=s.split(":"),r=o.shift();r;){if(0===o.length)return e[r]=i&&"object"==typeof e[r]?$.extend(!0,e[r],a):a,e[r];e=e[r]?e[r]:e[r]={},r=o.shift()}},r.prototype.release=function(){var t,e,i;i=this.__global_handlers__||{};for(e in i)t=i[e],Mercury.off(e,t);return this.off()},r.prototype.onRegionFocus=function(t){this.region=t},r.prototype.onButtonClick=function(){},r.prototype.appendActions=function(t){var e,i,n;n=[];for(e in t){if(i=t[e],"function"!=typeof i){if(!this[i])throw new Error(""+i+" doesn't exist");i=this[i]}n.push(this.actionsArray.push([e,i]))}return n},r.prototype.prependAction=function(t,e){if("function"!=typeof e){if(!this[e])throw new Error(""+e+" doesn't exist");e=this[e]}return this.actionsArray.unshift([t,e])},r.prototype.delegateEvents=function(t){var e,i,n,r=this;this.__global_handlers__||(this.__global_handlers__={}),n=[];for(e in t){if(i=t[e],"function"==typeof i)i=function(t){return function(){return t.apply(r,arguments),!0}}(i);else{if(!this[i])throw new Error(""+i+" doesn't exist");i=function(t){return function(){return r[t].apply(r,arguments),!0}}(i)}0!==e.indexOf("mercury:")?n.push(this.on(e,i)):(e=e.replace(/^mercury:/,""),this.__global_handlers__[e]=i,Mercury.on(e,i))}return n},r}(Mercury.Module),Mercury.Plugin.Module={registerPlugin:Mercury.Plugin.register,getPlugin:Mercury.Plugin.get},Mercury.Plugin.Definition=function(){function e(e){if(this.options=null!=e?e:{},this.name=this.options.name,!this.name)throw new Error("must provide a name for plugins");this.configuration=this.options.config,this.description=this.options.description,this.version=this.options.version,t[this.name]=this}return e.prototype.signature=function(t){var e,i,n;if(null==t&&(t=!0),i=$.extend({},this.options,{config:this.configuration}),!t)for(e in i)n=i[e],"function"==typeof n&&delete i[e];return i},e.prototype.config=function(t){var e,i,n,r,o,s;e=this.configuration||(this.configuration={});try{for(s=t.split(":"),r=0,o=s.length;o>r;r++)n=s[r],e=e[n]}catch(a){return i=a,Mercury.Config.get(t)}return"undefined"==typeof e?Mercury.Config.get(t):e},e.prototype.configure=function(){var t,e,i,r,o,s,a;if(t=1<=arguments.length?n.call(arguments,0):[],s=t.shift(),a=t.pop(),i=t.pop(),"object"==typeof s)return this.configuration=s;for(e=this.configuration||(this.configuration={}),o=s.split(":"),r=o.shift();r;){if(0===o.length)return e[r]=i&&"object"==typeof e[r]?$.extend(!0,e[r],a):a,e[r];e=e[r]?e[r]:e[r]={},r=o.shift()}},e}()}.call(this),function(){var t={}.hasOwnProperty,e=function(e,i){function n(){this.constructor=e}for(var r in i)t.call(i,r)&&(e[r]=i[r]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e},i=[].slice;Mercury.View=function(t){function n(t){var e,i,r;this.options=null!=t?t:{},r=this.options;for(e in r)i=r[e],this[e]=i;this.buildElement(),this.elements=$.extend({},this.constructor.elements,this.elements),this.events=$.extend({},this.constructor.events,this.events),this.attributes=$.extend({},this.constructor.attributes,this.attributes),this.subviews||(this.subviews=[]),this.refreshElements(),"function"==typeof this.build&&this.build(),this.trigger("build"),this.delegateEvents(this.events),this.refreshElements(),n.__super__.constructor.apply(this,arguments)}return e(n,t),n.include(Mercury.Config),n.include(Mercury.Events),n.include(Mercury.I18n),n.include(Mercury.Logger),n.Modules={},n.logPrefix="Mercury.View:",n.tag="div",n.prototype.eventSplitter=/^(\S+)\s*(.*)$/,n.prototype.buildElement=function(){return this.$el?this.el=this.$el.get(0):(this.el||(this.el=document.createElement(this.tag||this.constructor.tag)),this.$el=$(this.el)),this.attr(this.attributes),this.addClass(this.constructor.className),this.addClass(this.className),this.template||this.constructor.template?this.html(this.renderTemplate(this.template||this.constructor.template)):void 0},n.prototype.$=function(t){return $(t,this.$el)},n.prototype.addClass=function(t){return this.$el.addClass(t)},n.prototype.removeClass=function(t){return this.$el.removeClass(t)},n.prototype.attr=function(t,e){return t&&1===arguments.length?this.$el.attr(t):this.$el.attr(t,e)},n.prototype.css=function(t,e){return t&&1===arguments.length?this.$el.css(t):this.$el.css(t,e)},n.prototype.html=function(t){return arguments.length?(this.$el.html((null!=t?t.$el:void 0)||(null!=t?t.el:void 0)||t),this.localize(this.$el),this.refreshElements(),this.$el):this.$el.html()},n.prototype.append=function(){var t,e,n;return e=1<=arguments.length?i.call(arguments,0):[],e=function(){var i,n,r;for(r=[],i=0,n=e.length;n>i;i++)t=e[i],r.push(t.$el||t.el||t);return r}(),(n=this.$el).append.apply(n,e),this.refreshElements(),this.$el},n.prototype.appendTo=function(t){return this.$el.appendTo(t.$el||t.el||t),this.$el},n.prototype.appendView=function(t,e){return null==e&&(e=null),1===arguments.length&&(e=t,t=this.$el),"string"==typeof t&&(t=this.$(t)),e.appendTo?"function"==typeof e.appendTo&&e.appendTo(t):t.append(e.$el||e.el),this.subviews.push(e),e},n.prototype.delay=function(t,e){var i=this;return setTimeout(function(){return e.call(i)},t)},n.prototype.refreshElements=function(){var t,e,i,n;i=this.elements,n=[];for(t in i)e=i[t],n.push(this["$"+t]=this.$(e));return n},n.prototype.renderTemplate=function(t,e){var i;return null==e&&(e=null),"function"==typeof t?i=t:(i=JST["/mercury/templates/"+t],this.config("templates:enabled")&&!i&&(i=this.fetchTemplate(t))),"function"==typeof i?i.call(e||this):i},n.prototype.fetchTemplate=function(t){var e;return e=null,$.ajax({url:[this.config("templates:prefixUrl"),t].join("/"),async:!1,success:function(t){return e=t}}),e},n.prototype.localize=function(t){var e,i,n,r,o,s,a,l;for(a=t.find("*").contents(),l=[],o=0,s=a.length;s>o;o++)switch(i=a[o],e=i.attributes,"string"==typeof i.data&&(n=this.translationForContent(i.data))&&(i.data=n),i.nodeName){case"IMG":(n=this.translationForAttr(e.src))?l.push($(i).attr("src",n)):l.push(void 0);break;case"A":(n=this.translationForAttr(e.href))?l.push($(i).attr("href",n)):l.push(void 0);break;case"INPUT":r=e.type.nodeValue.toLowerCase(),!e.value||"button"!==r&&"reset"!==r&&"submit"!==r?l.push(void 0):(n=this.translationForAttr(e.value))?l.push($(i).attr("value",n)):l.push(void 0)}return l},n.prototype.translationForAttr=function(t){return t&&t.nodeValue?this.translationForContent(t.nodeValue):!1},n.prototype.translationForContent=function(t){var e,i;return(e=$.trim(t))?(i=this.t(e),i===e?!1:i):!1},n.prototype.focusFirstFocusable=function(){var t;return null!=(t=this.$(':input:visible[tabindex != "-1"]')[0])?t.focus():void 0},n.prototype.prevent=function(t,e){return null==e&&(e=!1),t&&t.preventDefault?(t.preventDefault(),e?t.stopPropagation():void 0):void 0},n.prototype.preventStop=function(t){return this.prevent(t,!0)},n.prototype.release=function(){var t,e,i;this.trigger("release"),this.releaseSubviews(),this.$el.remove(),i=this.__global_handlers__||{};for(e in i)t=i[e],Mercury.off(e,t);return this.off()},n.prototype.releaseSubviews=function(){var t,e,i,n;for(n=this.subviews||[],e=0,i=n.length;i>e;e++)t=n[e],t.release();return this.subviews=[]},n.prototype.delegateEvents=function(t,e){var i,n,r,o,s,a,l,u=this;1===arguments.length&&(e=t,t=this.$el),this.__global_handlers__||(this.__global_handlers__={}),l=[];for(n in e){if(o=e[n],"function"==typeof o)o=function(t){return function(){return t.apply(u,arguments),!0}}(o);else if(0===o.indexOf("mercury:"))o=o.replace(/^mercury:/,""),o=function(t){return function(){return Mercury.trigger(t,u),!0}}(o);else{if(!this[o])throw new Error(""+o+" doesn't exist");o=function(t){return function(){return u[t].apply(u,arguments),!0}}(o)}0!==n.indexOf("mercury:")?(a=n.match(this.eventSplitter),r=a[0],i=a[1],s=a[2],l.push(t.on(i,s||null,o))):(n=n.replace(/^mercury:/,""),this.__global_handlers__[n]=o,Mercury.on(n,o))}return l},n}(Mercury.Module)}.call(this),function(){Mercury.View.Modules.FormHandler={included:function(){return this.on("build",this.buildFormHandler)},buildFormHandler:function(){return this.delegateEvents({submit:this.onFormSubmit}),this.model?this.on("update",this.applySerializedModel):void 0},validate:function(){return this.clearInputErrors()},addInputError:function(t,e){return t.after('<span class="help-inline error-message">'+e+"</span>").closest(".control-group").addClass("error"),this.valid=!1},clearInputErrors:function(){return this.$(".control-group.error").removeClass("error").find(".error-message").remove(),this.valid=!0},applySerializedModel:function(){return this.model?this.$("form").applySerializedObject(this.model.toJSON()):void 0},serializeModel:function(){var t,e,i,n;if(this.clearInputErrors(),this.model.set(this.$("form").serializeObject()),!this.model.isValid()){i=this.model.errors,n=[];for(t in i)e=i[t],n.push(this.addInputError(this.$("[name="+t+"]"),e.join(", ")));return n}return this.trigger("form:success"),this.hideOnValidSubmit?this.hide():void 0},onFormSubmit:function(t){return this.prevent(t),this.validate(),this.model&&this.serializeModel(),this.valid?"function"==typeof this.onSubmit?this.onSubmit():void 0:void 0}},!function(t){t.serializeObject=function(e){var i={},n=i,r=e;return t.each(r,function(){for(var t=this.name.replace(/\[([^\]]+)?\]/g,",$1").split(","),e=t.length-1,r=0;e>r;r++)n.push?(n[n.length-1]&&n[n.length-1].constructor===Object&&void 0===n[n.length-1][t[r+1]]||n.push({}),n=n[n.length-1]):n=n[t[r]]=n[t[r]]||(""==t[r+1]?[]:{});
n.push?n.push(this.value):n[t[e]]=this.value,n=i}),i},t.deserializeObject=function i(t,e,n){var r,o,s,a;if(e=e||[],"[object Object]"===Object.prototype.toString.call(t)){for(r in t)if(s=n?[n,"[",r,"]"].join(""):r,t.hasOwnProperty(r))if(a=Object.prototype.toString.call(t[r]),"[object Array]"===a)for(o=0,jsonLen=t[r].length;jsonLen>o;o++)i(t[r][o],e,s+"[]");else"[object Object]"===a?i(t[r],e,s):e.push({name:s,value:t[r]})}else e.push({name:n,value:t});return e};var e=function(){var e=!!t.fn.prop;return function(t,i){e?t.prop("checked",i):t.attr("checked",i?"checked":null)}}();t.applySerializedArray=function(i,n){var r,o=t(i).find("input,select,textarea");e(o.filter(":checked"),!1);for(var s=n.length;s--;)r=o.filter("[name='"+n[s].name+"']"),r.filter(":checkbox").length?r.val()==n[s].value&&e(r.filter(":checkbox"),!0):r.filter(":radio").length?e(r.filter("[value='"+n[s].value+"']"),!0):r.val(n[s].value)},t.applySerializedObject=function(e,i){t.applySerializedArray(e,t.deserializeObject(i))},t.fn.serializeObject=t.fn.serializeObject||function(){return t.serializeObject(this.serializeArray())},t.fn.applySerializedObject=function(e){return t.applySerializedObject(this,e),this},t.fn.applySerializedArray=function(e){return t.applySerializedArray(this,e),this}}(jQuery)}.call(this),function(){Mercury.View.Modules.InterfaceFocusable={included:function(){return this.on("build",this.buildInterfaceFocusable)},buildInterfaceFocusable:function(){return this.revertFocusOn?(this.delegateEvents({mousedown:"handleFocusableEvent",mouseup:"handleFocusableEvent",click:"handleFocusableEvent"}),this.delegateRevertedFocus(this.revertFocusOn)):void 0},delegateRevertedFocus:function(t){var e;return e={},e["mousedown "+t]="revertInterfaceFocus",e["click "+t]="revertInterfaceFocus",this.delegateEvents(e)},handleFocusableEvent:function(t){return t.stopPropagation(),$(t.target).is(this.focusableSelector||":input, [tabindex]")?void 0:this.prevent(t)},revertInterfaceFocus:function(){return this.delay(1,function(){return Mercury.trigger("focus")})},preventFocusout:function(t){var e,i=this;return e=$(this.createFocusableKeeper().appendTo(this.$el)[0]),this.on("release",function(){return i.clearFocusout(e,t)}),this.on("hide",function(){return i.clearFocusout(e,t)}),e.on("blur",function(){return i.keepFocusConstrained(e,t)}),t.off("focusout").on("focusout",function(){return i.keepFocusConstrained(e,t)}),t.on("keydown",function(e){var n,r,o;if(9===e.keyCode&&(r=t.find(':input[tabindex != "-1"]'),r.length))return n=r[0],o=r[r.length-1],e.shiftKey&&e.target===n||!e.shiftKey&&e.target===o?i.prevent(e,!0):void 0})},createFocusableKeeper:function(){return $('<input style="position:fixed;left:100%;top:20px" tabindex="-1"/><input style="position:fixed;left:100%;top:20px"/>')},keepFocusConstrained:function(t,e){return this.preventFocusoutTimeout=this.delay(1,function(){return $.contains(e[0],document.activeElement)?void 0:t.focus()})},clearFocusout:function(t,e){return clearTimeout(this.preventFocusoutTimeout),t.off(),e.off("keydown").off("focusout")}}}.call(this),function(){Mercury.View.Modules.ScrollPropagation={preventScrollPropagation:function(t){return t.on("mousewheel DOMMouseScroll",function(e){var i,n,r;return r=[e.originalEvent.wheelDelta||-e.originalEvent.detail,t.scrollTop()],i=r[0],n=r[1],i>0&&0>=n?!1:0>i&&n>=t.get(0).scrollHeight-t.height()?!1:!0})}}}.call(this),function(){Mercury.View.Modules.VisibilityToggleable={included:function(){return this.on("build",this.buildVisibilityToggleable)},buildVisibilityToggleable:function(){return this.hidden?(this.visible=!0,this.hide()):this.show()},toggle:function(){return this.visible?this.hide():this.show()},show:function(t){return null==t&&(t=!0),this.visible?void 0:(this.trigger("show"),clearTimeout(this.visibilityTimout),"function"==typeof this.onShow&&this.onShow(),this.visible=!0,this.$el.show(),"function"==typeof this.position&&this.position(),this.visibilityTimout=this.delay(50,function(){return this.css({opacity:1}),t&&"boolean"==typeof t?"function"==typeof this.update?this.update():void 0:void 0}))},hide:function(t){return this.visible?("boolean"!=typeof t&&(t=null),null==t&&(t=this.releaseOnHide),this.trigger("hide"),clearTimeout(this.visibilityTimout),"function"==typeof this.onHide&&this.onHide(),this.visible=!1,this.css({opacity:0}),this.visibilityTimout=this.delay(250,function(){return this.$el.hide(),t?this.release():void 0})):void 0}}}.call(this),function(){var t,e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var r in i)e.call(i,r)&&(t[r]=i[r]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Mercury.Modal=function(e){function n(){return t=n.__super__.constructor.apply(this,arguments)}return i(n,e),n.include(Mercury.View.Modules.FormHandler),n.include(Mercury.View.Modules.InterfaceFocusable),n.include(Mercury.View.Modules.ScrollPropagation),n.include(Mercury.View.Modules.VisibilityToggleable),n.logPrefix="Mercury.Modal:",n.className="mercury-dialog mercury-modal",n.elements={dialog:".mercury-modal-dialog-positioner",content:".mercury-modal-dialog-content",contentContainer:".mercury-modal-dialog-content-container",titleContainer:".mercury-modal-dialog-title",title:".mercury-modal-dialog-title span"},n.events={"mercury:interface:resize":"resize","mercury:modals:hide":"hide","click .mercury-modal-dialog-title em":"hide"},n.prototype.primaryTemplate="modal",n.prototype.releaseOnHide=!0,n.prototype.buildElement=function(){return this.hidden&&(this.releaseOnHide=!1),this.negotiateTemplate(),n.__super__.buildElement.apply(this,arguments)},n.prototype.build=function(){return this.appendTo(),this.preventScrollPropagation(this.$contentContainer),this.preventFocusout(this.$contentContainer,this.focusFirstFocusable)},n.prototype.negotiateTemplate=function(){var t;return(t=this.options).template||(t.template=this.template),this.subTemplate=this.options.template,this.template=this.primaryTemplate},n.prototype.update=function(t){return this.visible&&this.updateForOptions(t)?(this.resize(),this.show(!1),this.refreshElements(),this.trigger("update"),this.delay(300,this.focusFirstFocusable)):void 0},n.prototype.updateForOptions=function(t){var e,i,n,r;this.options=$.extend({},this.options,t||{}),r=this.options;for(i in r)n=r[i],this[i]=n;return this.negotiateTemplate(),this.$title.html(this.t(this.title)),this.setWidth(this.width),e=this.contentFromOptions(),e===this.lastContent&&this.width===this.lastWidth?!1:(this.addClass("loading"),this.lastContent=e,this.lastWidth=this.width,this.$content.css({visibility:"hidden",opacity:0,width:this.width}).html(e),this.localize(this.$content),!0)},n.prototype.setWidth=function(t){return this.$dialog.css({width:t})},n.prototype.resize=function(t,e){var i,n,r;return null==t&&(t=!0),null==e&&(e=null),this.visible?(clearTimeout(this.showContentTimeout),"object"==typeof t&&(e=t,t=!1),t||this.addClass("mercury-no-animation"),this.$contentContainer.css({height:"auto"}),n=this.$titleContainer.outerHeight(),this.width?i=Math.min(this.$content.outerHeight()+n,$(window).height()-10):(this.$content.css({position:"absolute"}),r=this.$content.outerWidth(),i=Math.min(this.$content.outerHeight()+n,$(window).height()-10),this.$content.css({position:"static"})),this.$dialog.css({height:i,width:r||this.width}),this.$contentContainer.css({height:i-n}),t?this.showContentTimeout=this.delay(300,this.showContent):this.showContent(!1),this.delay(250,function(){return this.removeClass("mercury-no-animation")})):void 0},n.prototype.contentFromOptions=function(){return this.subTemplate?this.renderTemplate(this.subTemplate):this.content},n.prototype.showContent=function(t){return null==t&&(t=!0),clearTimeout(this.contentOpacityTimeout),this.removeClass("loading"),this.$content.css({visibility:"visible",width:"auto",display:"block"}),t?this.contentOpacityTimeout=this.delay(50,function(){return this.$content.css({opacity:1})}):this.$content.css({opacity:1})},n.prototype.appendTo=function(){return n.__super__.appendTo.call(this,Mercury["interface"])},n.prototype.release=function(){return this.visible?this.hide(!0):n.__super__.release.apply(this,arguments)},n.prototype.onShow=function(){return Mercury.trigger("blur"),Mercury.trigger("modals:hide")},n.prototype.onHide=function(){return Mercury.trigger("focus"),this.delay(250,function(){return this.lastWidth=null,this.$dialog.css({height:"",width:""}),this.$contentContainer.css({height:""}),this.$content.hide()})},n}(Mercury.View)}.call(this),function(){var t,e,i={}.hasOwnProperty,n=function(t,e){function n(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};t={},Mercury.Snippet=function(e){function i(t){var e,n,r;this.options=null!=t?t:{},this.configuration=this.options.config||{},r=this.options;for(e in r)n=r[e],"config"!==e&&(this[e]=n);if(!this.name)throw new Error("must provide a name for snippets");this.supportedRegions||(this.supportedRegions="all"),i.__super__.constructor.call(this,this.defaults||{})}return n(i,e),i.logPrefix="Mercury.Snippet:",i.register=function(t,e){return e.name=t,new Mercury.Snippet.Definition(e)},i.get=function(e,i){var n;if(null==i&&(i=!1),n=t[e],!n)throw new Error("unable to locate the "+e+" snippet");return i?new Mercury.Snippet(n.signature()):n},i.fromSerializedJSON=function(t){var e;return e=this.get(t.name,!0),e.cid=t.cid,e.set(t.attributes),e},i.all=function(){return t},i.unregister=function(e){var i;if(i=t[e],!i)throw new Error("unable to locate the "+e+" snippet");return delete t[e]},i.prototype.toSerializedJSON=function(){return{cid:this.cid,name:this.name,attributes:this.toJSON()}},i.prototype.initialize=function(t){return this.region=t,"all"!==this.supportedRegions&&-1===this.supportedRegions.indexOf(this.region.type())?alert(this.t("Unable to use the "+this.name+" snippet in that region. Supported regions: "+this.supportedRegions.join(", "))):this.form?this.displayForm():this.render()},i.prototype.delay=function(t,e){var i=this;return setTimeout(function(){return e.call(i)},t)},i.prototype.displayForm=function(t){var e,i=this;return e=new(this.Modal||Mercury.Modal)({title:this.get("title"),template:this.templateClosure(t||this.form),width:600,model:this,hideOnValidSubmit:!0}),e.on("form:success",function(){return i.render()})},i.prototype.render=function(t){return null==t&&(t={}),t=$.extend({},this.renderOptions,t),this.url()&&!this.renderedView?this.save(t):this.renderView(t.template)},i.prototype.renderView=function(t){return this.renderedView=this.view(this.templateClosure(t||this.template)),this.trigger("rendered",this.renderedView),this.delay(1,this.afterRender)},i.prototype.afterRender=function(){},i.prototype.view=function(t){return new Mercury.Snippet.View({template:t,snippet:this})},i.prototype.saveSuccess=function(t){var e=this;return this.renderView(function(){return e.get("preview")||t})},i.prototype.templateClosure=function(t){var e;return"function"==typeof t&&(e=function(){return t.apply(null,arguments)}),e||t},i.prototype.getRenderedView=function(){return this.renderedView},i.prototype.replaceWithView=function(t){return t.replaceWith(this.renderedView.$el),this.afterRender()},i.prototype.renderAndReplaceWithView=function(t,e){return null==e&&(e=null),this.one("rendered",function(i){return t.replaceWith(i.$el),"function"==typeof e?e(t,i):void 0}),this.render()},i}(Mercury.Model),Mercury.Snippet.Module={registerSnippet:Mercury.Snippet.register,getSnippet:Mercury.Snippet.get},Mercury.Snippet.Definition=function(){function e(e){if(this.options=null!=e?e:{},this.name=this.options.name,!this.name)throw new Error("must provide a name for snippets");this.configuration=this.options.config,this.title=this.options.title,this.description=this.options.description,this.version=this.options.version,t[this.name]=this}return e.prototype.signature=function(t){var e,i,n;if(null==t&&(t=!0),i=$.extend({},this.options,{config:this.configuration}),!t)for(e in i)n=i[e],"function"==typeof n&&delete i[e];return i},e}(),Mercury.Snippet.View=function(t){function i(){return e=i.__super__.constructor.apply(this,arguments)}return n(i,t),i.prototype.build=function(){return this.addClass("mercury-"+this.snippet.name+"-snippet"),this.attr({"data-mercury-snippet":this.snippet.cid}),this.attr("contenteditable",!1),this.$el.data({snippet:this.snippet})},i}(Mercury.View)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,i){function n(){this.constructor=e}for(var r in i)t.call(i,r)&&(e[r]=i[r]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e},i=[].slice;Mercury.Region=function(t){function n(t,e){var i;return this.el=t,this.options=null!=e?e:{},this.el&&$(this.el).data("region")?!1:this.constructor.supported?(this.actions||(this.actions={}),this.context=$.extend({},this.constructor.context,this.context),this.dataAttrs=$.extend({},this.constructor.dataAttrs,this.dataAttrs),this.options=$.extend({},this.options,this.config("regions:"+this.type())),this.el&&(i=this.config("regions:options"))&&(this.options=$.extend(this.options,JSON.parse($(this.el).attr(i)||"{}"))),this.placeholder||(this.placeholder=this.options.placeholder||""),"function"==typeof this.beforeBuild&&this.beforeBuild(),n.__super__.constructor.call(this,this.options),this.$focusable||this.attr({tabindex:0}),this.name||(this.name=this.$el.attr(this.config("regions:identifier"))),this.previewing||(this.previewing=!1),this.focused||(this.focused=!1),this.$focusable||(this.$focusable=this.$el),this.skipHistoryOn||(this.skipHistoryOn=["redo"]),this.changed||(this.changed=!1),this.setInitialData(),"function"==typeof this.afterBuild&&this.afterBuild(),this.$el.data({region:this}),this.$focusable.attr({"data-placeholder":this.placeholder}),this.name||(this.notify(this.t("No name provided for the %s region, falling back to random",this.type())),this.name=""+this.type()+Math.floor(1e4*Math.random()),this.$el.attr(this.config("regions:identifier"),this.name)),this.addRegionAttrs(),this.skipHistoryOnInitialize||this.pushHistory(),this.bindDefaultEvents(),this.initialValue=JSON.stringify(this.toJSON()),void 0):(this.notify(this.t("Is unsupported in this browser")),!1)}return e(n,t),n.extend(Mercury.Config),n.extend(Mercury.Events),n.extend(Mercury.I18n),n.extend(Mercury.Logger),n.include(Mercury.Stack),n.Modules={},n.supported=!0,n.logPrefix="Mercury.Region:",n.type="unknown",n.defaultActions={undo:"onUndo",redo:"onRedo"},n.define=function(t,e,i){return this.klass=t,this.type=e,null==i&&(i={}),this.logPrefix=this.prototype.logPrefix=""+this.klass+":",this.prototype.actions=$.extend(this.prototype.actions,i),this.prototype.toolbars=[this.type],this.off(),this},n.create=function(t){var e;return t=$(t),e=t.attr(this.config("regions:attribute")),e||this.notify(this.t("Region type not provided")),e=(""+e).toLowerCase().toCamelCase(!0),Mercury.Region[e]||this.notify(this.t("Unknown %s region type, falling back to base region",e)),new(Mercury.Region[e]||Mercury.Region)(t)},n.addAction=function(t,e){var i;return"object"==typeof t?i=t:(i={},i[t]=e),this.actions=$.extend(this.actions||{},i)},n.addContext=function(t,e){var i;return"object"==typeof t?i=t:(i={},i[t]=e),this.context=$.extend(this.context||{},i)},n.addData=function(t,e){var i;return"object"==typeof t?i=t:(i={},i[t]=e),this.dataAttrs=$.extend(this.dataAttrs||{},i)},n.addToolbar=function(t,e){var i;return null==e&&(e={}),"object"==typeof t&&(e=t,t=this.type),i=t===this.type?"toolbars:"+t:"toolbars:"+this.type+":"+t,Mercury.configure(i,e)},n.prototype.setInitialData=function(){var t,e,i,n,r;n=this.dataAttrs,r=[];for(t in n)e=n[t],i={},i[t]=this.$el.data(t)||null,r.push(this.data(i));return r},n.prototype.addRegionAttrs=function(){return this.addClass("mercury-"+this.type()+"-region"),this.$focusable.attr("data-mercury-region",!0)},n.prototype.type=function(){return this.constructor.type},n.prototype.trigger=function(t){return n.__super__.trigger.apply(this,arguments),Mercury.trigger("region:"+t,this)},n.prototype.hasAction=function(t){return!!this.actions[t]},n.prototype.hasContext=function(t,e){return null==e&&(e=!1),this.context[t]?(t=this.context[t].call(this,t),e?t:!!t):!1},n.prototype.handleAction=function(t,e){var i,n;return null==e&&(e={}),this.focused&&!this.previewing?(this.skipHistoryOn.indexOf(t)>-1||this.pushHistory(),i=Mercury.Action.create(t,e),null!=(n=this.actions[t])&&n.call(this,i),this.trigger("action",i),this.trigger("update"),!0):void 0},n.prototype.handleMode=function(){var t,e,n;return t=1<=arguments.length?i.call(arguments,0):[],e=t.shift(),"function"==typeof this[n=("toggle_"+e).toCamelCase()]?this[n].apply(this,t):void 0},n.prototype.togglePreview=function(){return this.previewing=!this.previewing,this.trigger("preview",this.previewing),this.previewing?(this.blur(),this.$focusable.removeAttr("tabindex").removeAttr("data-mercury-region")):this.$focusable.attr({tabindex:0}).attr("data-mercury-region",!0),"function"==typeof this.onTogglePreview?this.onTogglePreview():void 0},n.prototype.pushHistory=function(t){var e,i,n=this;return null==t&&(t=null),t&&(e=[13,46,8].indexOf(t)),(null===t||e>=0&&e!==this.lastKeyCode)&&(i=!0),this.lastKeyCode=e,clearTimeout(this.historyTimeout),i?this.pushStack(this.toStack()):this.historyTimeout=this.delay(2500,function(){return n.pushStack(n.toStack())})},n.prototype.focus=function(t,e){var i,n;return null==t&&(t=!1),null==e&&(e=!1),this.focused=!0,i=window.scrollX,n=window.scrollY,(e||!this.$focusable.is(":focus"))&&this.$focusable.focus(),t||window.scrollTo(i,n),"function"==typeof this.onFocus?this.onFocus():void 0},n.prototype.blur=function(){return this.focused=!1,this.$focusable.blur(),"function"==typeof this.onBlur?this.onBlur():void 0},n.prototype.value=function(t){return null==t&&(t=null),null===t||"undefined"==typeof t?this.html():this.html(t)},n.prototype.data=function(t,e){var i,n;return"string"==typeof t&&1===arguments.length||0===arguments.length?(i=this.$el.data(t),0===arguments.length&&(i=$.extend({},i),this.cleanData(i)),null!=i?i:null):(n=t,"string"==typeof t&&(n={},n[t]=e),this.setData(n),this.$el)},n.prototype.cleanData=function(t){return delete t.region,delete t.mercury,delete t.mercuryRegion,delete t.placeholder,delete t.regionOptions},n.prototype.setData=function(t){var e,i,n,r;this.$el.data(t),r=[];for(e in t)i=t[e],r.push(null!=(n=this.dataAttrs[e])?"function"==typeof n.call?n.call(this,i):void 0:void 0);return r},n.prototype.snippets=function(){return{}},n.prototype.hasChanges=function(){return this.changed||this.initialValue!==JSON.stringify(this.toJSON())},n.prototype.onSave=function(){return this.initialValue=JSON.stringify(this.toJSON()),this.changed=!1},n.prototype.onUndo=function(){return this.fromStack(this.undoStack())},n.prototype.onRedo=function(){return this.fromStack(this.redoStack())},n.prototype.onItemDropped=function(t){var e,i,n;if(!this.previewing)return e=t.originalEvent.dataTransfer,this.focus(),e.files.length&&this.onDropFile?(this.prevent(t),this.onDropFile(e.files)):this.onDropSnippet&&(n=e.getData("snippet"))?(this.onDropSnippet(i=Mercury.Snippet.get(n,!0)),i.initialize(this)):"function"==typeof this.onDropItem?this.onDropItem(t,e):void 0},n.prototype.toStack=function(){return this.toJSON()},n.prototype.fromStack=function(t){return t?this.fromJSON(t):void 0},n.prototype.toJSON=function(t){return null==t&&(t=!1),{name:this.name,type:this.type(),value:this.value(),data:this.data(),snippets:this.snippets()}},n.prototype.fromJSON=function(t){return"string"==typeof t&&(t=JSON.parse(t)),null!==t.value&&"undefined"!=typeof t.value&&this.value(t.value),t.data?this.data(t.data):void 0},n.prototype.load=function(t){return this.fromJSON(t),"function"==typeof this.loadSnippets?this.loadSnippets(t.snippets||{}):void 0},n.prototype.release=function(){return this.$el.data({region:null}),this.removeClass("mercury-"+this.type()+"-region"),this.$focusable.removeAttr("tabindex").removeAttr("data-mercury-region"),this.trigger("release"),this.$el.off(),this.$focusable.off(),this.off(),this.blur()},n.prototype.bindDefaultEvents=function(){return this.delegateActions($.extend(!0,this.constructor.actions,this.constructor.defaultActions,this.actions||(this.actions={}))),this.delegateEvents({"mercury:action":function(){return this.handleAction.apply(this,arguments)},"mercury:mode":function(){return this.handleMode.apply(this,arguments)},"mercury:save":function(){return this.onSave()}}),this.bindFocusEvents(),this.bindKeyEvents(),this.bindMouseEvents(),this.bindDropEvents()},n.prototype.bindFocusEvents=function(){var t=this;return this.delegateEvents(this.$focusable,{focus:function(){return t.focused=!0,t.trigger("focus"),"function"==typeof t.onFocus?t.onFocus():void 0},blur:function(){return t.focused=!1,t.trigger("blur"),"function"==typeof t.onBlur?t.onBlur():void 0}})},n.prototype.bindKeyEvents=function(){var t=this;return this.delegateEvents(this.$focusable,{keyup:function(){return t.trigger("update")},keydown:function(e){return e.metaKey&&90===e.keyCode?(t.prevent(e),e.shiftKey?t.handleAction("redo"):t.handleAction("undo")):void 0}})},n.prototype.bindMouseEvents=function(){var t=this;return this.delegateEvents(this.$focusable,{mouseup:function(){return t.trigger("update")}})},n.prototype.bindDropEvents=function(){var t=this;if(this.onDropFile||this.onDropItem||this.onDropSnippet)return this.delegateEvents(this.$el,{dragenter:function(e){return t.previewing?void 0:t.prevent(e)},dragover:function(e){return t.previewing||t.editableDropBehavior&&Mercury.support.webkit&&!Mercury.dragHack?void 0:t.prevent(e)},drop:"onItemDropped"})},n.prototype.delegateActions=function(t){var e,i,n;n=[];for(e in t){if(i=t[e],"function"!=typeof i){if(!this[i])throw new Error(""+i+" doesn't exist");i=this[i]}n.push(this.actions[e]=i)}return n},n}(Mercury.View)}.call(this),function(){Mercury.View.Modules.Draggable={startDrag:function(t){var e;if(!(t.button>1))return this.prevent(t),this.viewportSize={width:$(window).width(),height:$(window).height()},e=this.$el.position(),this.dragPosition={x:-1*e.left,y:-1*e.top},this.potentialDragStart(t.pageX,t.pageY)},potentialDragStart:function(t,e){return this.startPosition={x:this.dragPosition.x,y:this.dragPosition.y},this.initialPosition={x:t,y:e},this.potentiallyDragging=!0,this.bindDocumentDragEvents(document),Mercury["interface"].document&&Mercury["interface"].document!==document?this.bindDocumentDragEvents(Mercury["interface"].document):void 0},onStartDragging:function(t,e){return this.addClass("mercury-no-animation"),this.dragging=!0,this.initialPosition={x:t,y:e},"function"==typeof this.onDragStart?this.onDragStart():void 0},onDrag:function(t){var e,i,n,r;return this.prevent(t),n=t.pageX,r=t.pageY,!this.dragging&&(Math.abs(this.initialPosition.x-n)>5||Math.abs(this.initialPosition.y-r)>5)?this.onStartDragging(n,r):(this.lastPosition=this.dragPosition,e=-1*(this.startPosition.x-n+this.initialPosition.x),i=-1*(this.startPosition.y-r+this.initialPosition.y),this.dragPosition={x:e,y:i},this.setPositionOnDrag(e,i))},onEndDragging:function(t){return this.dragging===!0&&"function"==typeof this.onDragEnd&&this.onDragEnd(t),this.dragging=!1,this.potentiallyDragging=!1,this.unbindDocumentDragEvents(document),Mercury["interface"].document&&Mercury["interface"].document!==document&&this.unbindDocumentDragEvents(Mercury["interface"].document),this.delay(250,function(){return this.removeClass("mercury-no-animation")})},bindDocumentDragEvents:function(t){var e=this;return $(t).on("mousemove",this.onDragHandler=function(t){return e.onDrag(t)}).on("mouseup",this.onEndDraggingHandler=function(t){return e.onEndDragging(t)})},unbindDocumentDragEvents:function(t){return $(t).off("mousemove",this.onDragHandler).off("mouseup",this.onEndDraggingHandler)},setPositionOnDrag:function(t,e){return this.css({top:e,left:t})}}}.call(this),function(){Mercury.View.Modules.InterfaceMaskable={included:function(){return this.on("build",this.buildInterfaceMaskable)},extended:function(){return this.on("build",this.buildInterfaceMaskable)},buildInterfaceMaskable:function(){return this.$mask=$('<div class="mercury-interface-mask">'),this.append(this.$mask),this.delegateEvents({"mercury:interface:mask":this.mask,"mercury:interface:unmask":this.unmask,"mousedown .mercury-interface-mask":this.prevent,"mouseup .mercury-interface-mask":this.prevent,"click .mercury-interface-mask":this.onMaskClick})},mask:function(){return this.$mask.show()},unmask:function(){return this.$mask.hide()},onMaskClick:function(t){return this.prevent(t,!0),Mercury.trigger("dialogs:hide")}}}.call(this),function(){Mercury.View.Modules.InterfaceShadowed={included:function(){return this.on("init",this.buildInterfaceShadowed)},extended:function(){return this.on("init",this.buildInterfaceShadowed)},buildInterfaceShadowed:function(){return this.el.webkitCreateShadowRoot?(this.shadow=$(this.el.webkitCreateShadowRoot()),this.el=document.createElement(this.tag||this.constructor.tag),this.$el=$(this.el),this.shadow.get(0).applyAuthorStyles=!0,this.shadow.append(this.el)):void 0}}}.call(this),function(){Mercury.View.Modules.ToolbarDialog={included:function(){return this.on("build",this.buildToolbarDialog)},buildToolbarDialog:function(){return this.delegateEvents({"mercury:dialogs:hide":function(){return"function"==typeof this.hide?this.hide():void 0},"mercury:interface:resize":"positionAndResize"}),this.on("show",function(){return this.visible||Mercury.trigger("interface:mask"),!0}),this.on("hide",function(){return this.visible&&Mercury.trigger("interface:unmask"),!0})},positionAndResize:function(t){return this.position(t),this.resize(!1,t)},position:function(){var t,e,i,n,r,o,s,a;return this.css({top:0,left:0}),r=this.$el.parent(),a=$(window),s={width:a.width(),height:a.height()},t={width:this.$el.outerWidth(),height:this.$el.outerHeight()},n={width:r.outerWidth(),height:r.outerHeight()},i=r.offset(),i.left-=window.scrollX,i.top-=window.scrollY,e=0,t.width+i.left>s.width&&(e=-t.width+n.width),i.left+e<0&&(e-=i.left+e),o=n.height,t.height+i.top+n.height>s.height&&(o=-t.height),i.top+o+n.height<0&&(o-=i.top+o+n.height),this.css({top:o,left:e})},resize:function(){}}}.call(this),function(){var t,e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var r in i)e.call(i,r)&&(t[r]=i[r]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Mercury.Model.Page=function(e){function n(){return t=n.__super__.constructor.apply(this,arguments)}return i(n,e),n.define("Mercury.Model.Page"),n.prototype.save=function(t){return null==t&&(t={}),n.__super__.save.call(this,$.extend(this.config("saving"),t))},n}(Mercury.Model)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var r in i)e.call(i,r)&&(t[r]=i[r]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Mercury.BaseInterface=function(e){function n(){return this.onUnload=t(this.onUnload,this),this.onResize=t(this.onResize,this),this.hideDialogs=t(this.hideDialogs,this),parent!==window&&parent.Mercury?(this.log(this.t("Has already been defined in parent frame")),void 0):(this.config("interface:maskable")&&this.extend(Mercury.View.Modules.InterfaceMaskable),this.config("interface:shadowed")&&this.extend(Mercury.View.Modules.InterfaceShadowed),Mercury["interface"]||(Mercury["interface"]=this),this.floating||(this.floating=this.config("interface:floating")),this.visible=!0,n.__super__.constructor.apply(this,arguments),this.page=new Mercury.Model.Page,this.regions||(this.regions=[]),$(window).on("beforeunload",this.onUnload),$(window).on("resize",this.onResize),this.initialize(),this.buildInterface(),this.bindDefaultEvents(),Mercury.trigger("initialized"),void 0)}return i(n,e),n.include(Mercury.Module),n.include(Mercury.View.Modules.Draggable),n.logPrefix="Mercury.BaseInterface:",n.tag="mercury",n.events={"mercury:save":"save","mercury:focus":"focusActiveRegion","mercury:blur":"blurActiveRegion","mercury:resize":"onResize","mercury:action":"focusActiveRegion","mercury:region:focus":"onRegionFocus","mercury:region:release":"onRegionRelease","mercury:reinitialize":"reinitialize","mercury:interface:toggle":"toggle","mousedown .mercury-drag-handle":"startDrag"},n.prototype.build=function(){return this.el||(this.el=document.createElement(this.tag||this.constructor.tag)),this.$el=$(this.el),this.attr(this.attributes),this.config("interface:floatDrag")?this.append('<div class="mercury-drag-handle"/>'):void 0},n.prototype.init=function(){return $("body").before(this.$el)},n.prototype.initialize=function(){return this.addAllRegions(),this.bindDocumentEvents()},n.prototype.load=function(t){var e,i,n,r,o;n=t.contents||t,o=[];for(i in n)e=n[i],o.push(null!=(r=this.findRegionByName(i))?r.load(e):void 0);return o},n.prototype.findRegionByName=function(t){var e,i,n,r;for(r=this.regions||[],i=0,n=r.length;n>i;i++)if(e=r[i],e.name===t)return e;return null},n.prototype.addAllRegions=function(){var t,e,i,n;for(n=this.regionElements(),e=0,i=n.length;i>e;e++)t=n[e],this.addRegion(t);return this.region||(this.region=this.regions[0])},n.prototype.bindDocumentEvents=function(){return this.config("interface:mask")?void 0:$("body",this.document).on("mousedown",this.hideDialogs)},n.prototype.buildInterface=function(){var t,e,i,n,r;for(this.addClasses(),r=["toolbar","statusbar"],i=0,n=r.length;n>i;i++)e=r[i],(t=this.config("interface:"+e))&&(this[e]=this.appendView(new Mercury[t]));return this.config("interface:enabled")||(this.previewMode=!0,this.hide(),Mercury.trigger("mode","preview")),this.focusDefaultRegion(),this.onResize(),this.delay(500,function(){return this.removeClass("loading")})},n.prototype.addClasses=function(){return this.addClass(this.className),this.addClass("loading"),this.addClass(this.config("interface:style")||"standard"),this.floating&&this.addClass("mercury-floating"),this.addClass("locale-"+Mercury.I18n.detectLocale().join("-").toLowerCase())},n.prototype.bindDefaultEvents=function(){return this.delegateEvents({"mercury:mode":function(t){return this.setMode(t)},"mercury:action":function(){return this.focusActiveRegion()}})},n.prototype.reinitialize=function(){return this.addAllRegions(),this.focusDefaultRegion()},n.prototype.setInterface=function(t){return"float"===t&&(t="mercury-floating",this.floating=!0,$("body").hasClass("mercury-transitions")&&$("body").removeClass("mercury-transitions").addClass("mercury-no-transitions")),this.addClass(t),this.position(),this.onResize()},n.prototype.removeInterface=function(t){return"float"===t&&(t="mercury-floating",this.floating=!1,this.placed=!1,this.css({position:""})),$("body").hasClass("mercury-no-transitions")&&$("body").removeClass("mercury-no-transitions").addClass("mercury-transitions"),this.removeClass(t),this.position(),this.onResize()},n.prototype.focusDefaultRegion=function(){return this.delay(100,this.focusActiveRegion)},n.prototype.regionElements=function(){return $("["+this.config("regions:attribute")+"]",this.document)},n.prototype.addRegion=function(t){var e;if(!$(t).data("region"))return e=Mercury.Region.create(t),this.regions.push(e)},n.prototype.focusActiveRegion=function(){var t;return null!=(t=this.region)?t.focus(!1,!0):void 0},n.prototype.blurActiveRegion=function(){var t;return null!=(t=this.region)?t.blur():void 0},n.prototype.setMode=function(t){return this[""+t+"Mode"]=!this[""+t+"Mode"],this.focusActiveRegion(),"preview"===t?this.delay(50,function(){return this.position()}):void 0},n.prototype.toggle=function(){return this.visible?this.hide():this.show()},n.prototype.show=function(){return this.visible?void 0:(Mercury.trigger("interface:show"),this.previewMode&&Mercury.trigger("mode","preview"),this.$el.show(),this.visible=!0,this.onResize(),this.$el.stop().animate({opacity:1},{duration:250}),this.position())},n.prototype.hide=function(){var t=this;if(this.visible)return this.hiding=!0,Mercury.trigger("interface:hide"),this.previewMode||Mercury.trigger("mode","preview"),$("body").css({position:"relative",top:0}),this.visible=!1,this.position(),this.$el.stop().animate({opacity:0},{duration:250,complete:function(){return t.$el.hide(),t.hiding=!1}})},n.prototype.dimensions=function(){var t,e,i,n;return this.floating?(e=0,t=0):(e=null!=(i=this.toolbar)?i.height():void 0,t=null!=(n=this.statusbar)?n.height():void 0),{top:e,left:0,right:0,bottom:t,width:$(window).width(),height:$(window).height()-e-t}},n.prototype.hasChanges=function(){var t,e,i,n;for(n=this.regions,e=0,i=n.length;i>e;e++)if(t=n[e],t.hasChanges())return!0;return!1},n.prototype.hideDialogs=function(){return Mercury.trigger("dialogs:hide")
},n.prototype.release=function(){for($(window).off("resize",this.resize),$("body").css({position:"",top:""}),$("body",this.document).off("mousedown",this.hideDialogs);this.regions.length;)this.regions.shift().release();return n.__super__.release.apply(this,arguments)},n.prototype.serialize=function(){var t,e,i,n,r;for(t={},r=this.regions,i=0,n=r.length;n>i;i++)e=r[i],t[e.name]=e.toJSON(!0);return t},n.prototype.save=function(){var t=this;return this.page.set({content:this.serialize(),location:location.pathname}),this.page.on("error",function(e,i){return alert(t.t("Unable to save to the url: %s",i.url))}),this.page.save().always=function(){return t.delay(250,function(){return Mercury.trigger("save:complete")})}},n.prototype.heightForWidth=function(t){var e,i;return i=this.$el.outerWidth(),this.css({width:t,visibility:"hidden",height:"auto"}),e=this.$el.outerHeight(),this.css({width:i,visibility:"visible"}),e},n.prototype.position=function(t){var e,i,n,r,o,s;return null==t&&(t=!1),this.floating&&this.region&&!this.placed&&!this.hiding?(this.addClass("mercury-no-animation"),r=this.positionForRegion(),this.width=s=Math.max(this.config("interface:floatWidth")||this.region.$el.width(),300),i=this.heightForWidth(s),n=r.left,o=$(window).width(),n+s>o&&(n-=n+s-o),e=function(){return t&&this.removeClass("mercury-no-animation"),this.css({top:r.top-i,left:n,width:s})},t?(this.delay(20,e),this.delay(300,function(){return Mercury.trigger("interface:resize",this.dimensions())})):e.call(this)):void 0},n.prototype.positionForRegion=function(){return this.region.$el.offset()},n.prototype.onDragStart=function(){return Mercury.trigger("dialogs:hide")},n.prototype.setPositionOnDrag=function(t,e){return this.placed||(this.placed=!0,this.startPosition.x+=window.scrollX,this.startPosition.y+=window.scrollY,t-=window.scrollX,e-=window.scrollY,this.lastPosition={x:t,y:e},this.css({position:"fixed",top:e,left:t})),0>t&&(t=0),0>e&&(e=0),t>this.viewportSize.width-50&&(t=this.viewportSize.width-50),e>this.viewportSize.height-50&&(e=this.viewportSize.height-50),this.css({top:e,left:t}),this.width?void 0:this.onResize()},n.prototype.onRegionFocus=function(t){return this.region=t,this.delay(50,function(){return this.floating?this.position(!0):this.onResize()})},n.prototype.onRegionRelease=function(t){var e;return t===this.region&&(this.region=this.regions[0]),e=this.regions.indexOf(t),e>-1?this.regions.splice(e,1):void 0},n.prototype.onResize=function(){var t;return t=this.dimensions(),$("body").css({position:"relative",top:t.top}),this.visible?(Mercury.trigger("interface:resize",t),this.position(),t):void 0},n.prototype.onUnload=function(){return!this.config("interface:silent")&&this.hasChanges()?this.t("You have unsaved changes.  Are you sure you want to leave without saving them first?"):void 0},n}(Mercury.View)}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}},i={}.hasOwnProperty,n=function(t,e){function n(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};Mercury.FrameInterface=function(i){function r(){return this.onResize=e(this.onResize,this),this.onScroll=e(this.onScroll,this),t=r.__super__.constructor.apply(this,arguments)}return n(r,i),r.logPrefix="Mercury.FrameInterface:",r.className="mercury-frame-interface",r.prototype.initialize=function(){return this.$frame=$(this.frame).addClass("mercury-frame-interface-frame"),this.$frame.length?void 0:(this.initialized=!0,r.__super__.initialize.apply(this,arguments))},r.prototype.load=function(t){return this.loadedJSON=t,this.initialized?r.__super__.load.apply(this,arguments):void 0},r.prototype.reinitialize=function(){return this.$frame.length?(this.initialized=!1,this.initializeFrame()):r.__super__.reinitialize.apply(this,arguments)},r.prototype.bindDefaultEvents=function(){var t=this;return this.$frame.on("load",function(){return t.initializeFrame(),t.load(t.loadedJSON),t.$frame.off("load").on("load",function(){return t.reinitializeFrame()})}),this.delegateEvents({"mercury:initialize":function(){return this.initializeFrame()}}),r.__super__.bindDefaultEvents.apply(this,arguments)},r.prototype.bindDocumentEvents=function(){return $(this.window).on("scroll",this.onScroll),r.__super__.bindDocumentEvents.apply(this,arguments)},r.prototype.initializeFrame=function(){return this.initialized?void 0:(this.initialized=!0,this.regions||(this.regions=[]),this.setupDocument(),this.bindDocumentEvents(),this.addAllRegions(),this.hijackLinksAndForms(),this.trigger("initialized"),Mercury.trigger("initialized"),this.delay(100,this.focusDefaultRegion))},r.prototype.reinitializeFrame=function(){return this.frameLocation()?(this.initialized=!1,this.regions=[],this.initializeFrame(),this.load(this.loadedJSON)):(alert(this.t("You've left editing the page you were on, please refresh the page.")),this.release())},r.prototype.frameLocation=function(){var t,e;return null!=(t=this.$frame.get(0))?null!=(e=t.contentWindow)?e.location.href:void 0:void 0},r.prototype.setupDocument=function(){var t;return this.window=this.$frame.get(0).contentWindow,(t=this.window).Mercury||(t.Mercury=Mercury),this.window.Mercury["interface"]=this,this.document=$(this.window.document)},r.prototype.hide=function(){return this.$frame.css({top:0,height:"100%"}),r.__super__.hide.apply(this,arguments)},r.prototype.positionForRegion=function(){var t;return t=r.__super__.positionForRegion.apply(this,arguments),this.$frame.length&&(t.top-=$("body",this.document).scrollTop()),t},r.prototype.hijackLinksAndForms=function(){var t,e,i,n,r,o,s,a,l,u,c,h;for(r=this.config("interface:nohijack")||[],o="["+this.config("regions:attribute")+"]",c=$("a, form",this.document),h=[],s=0,l=c.length;l>s;s++){for(i=c[s],t=$(i),n=!1,a=0,u=r.length;u>a;a++)e=r[a],t.hasClass(e)&&(n=!0);n||""!==i.target&&"_self"!==i.target||t.closest(o).length?h.push(void 0):h.push(t.attr("target","_parent"))}return h},r.prototype.release=function(){var t;this.$frame.css({top:0}),$(this.window).off("scroll",this.onScroll),r.__super__.release.apply(this,arguments);try{if(t=this.frameLocation())return window.location.href=t}catch(e){}},r.prototype.onScroll=function(){return this.position()},r.prototype.onResize=function(){var t;return t=r.__super__.onResize.apply(this,arguments),t?this.$frame.css({top:t.top,height:t.height}):void 0},r}(Mercury.BaseInterface)}.call(this),function(){var t,e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var r in i)e.call(i,r)&&(t[r]=i[r]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Mercury.Lightview=function(e){function n(){return t=n.__super__.constructor.apply(this,arguments)}return i(n,e),n.logPrefix="Mercury.Lightview:",n.className="mercury-dialog mercury-lightview",n.elements={dialog:".mercury-lightview-dialog-positioner",content:".mercury-lightview-dialog-content",contentContainer:".mercury-lightview-dialog-content-container",titleContainer:".mercury-lightview-dialog-title",title:".mercury-lightview-dialog-title span"},n.events={"mercury:interface:resize":"resize","mercury:modals:hide":"hide","click .mercury-lightview-dialog-title em":"hide"},n.prototype.primaryTemplate="lightview",n.prototype.releaseOnHide=!0,n.prototype.build=function(){return n.__super__.build.apply(this,arguments),this.defaultPosition()},n.prototype.defaultPosition=function(){return this.$dialog.css({marginTop:($(window).height()-75)/2})},n.prototype.resize=function(t,e){var i,n;return null==t&&(t=!0),null==e&&(e=null),this.visible?(clearTimeout(this.showContentTimeout),"object"==typeof t&&(e=t,t=!1),t||this.addClass("mercury-no-animation"),this.$contentContainer.css({height:"auto"}),this.$content.css({width:Math.min(this.$content.outerWidth(),$(window).width())}),n=this.$titleContainer.outerHeight(),i=Math.min(this.$content.outerHeight()+n,$(window).height()),this.$dialog.css({marginTop:($(window).height()-i)/2,height:i}),this.$content.css({width:"auto"}),this.$contentContainer.css({height:i-n}),t?this.showContentTimeout=this.delay(300,this.showContent):this.showContent(!1),this.removeClass("mercury-no-animation")):void 0},n.prototype.onHide=function(){return n.__super__.onHide.apply(this,arguments),this.delay(250,this.defaultPosition)},n}(Mercury.Modal)}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}},i={}.hasOwnProperty,n=function(t,e){function n(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};Mercury.Panel=function(i){function r(){return this.resize=e(this.resize,this),t=r.__super__.constructor.apply(this,arguments)}return n(r,i),r.include(Mercury.View.Modules.Draggable),r.logPrefix="Mercury.Panel:",r.className="mercury-dialog mercury-panel",r.elements={content:".mercury-panel-content",contentContainer:".mercury-panel-content-container",titleContainer:".mercury-panel-title",title:".mercury-panel-title span"},r.events={"mercury:interface:resize":"resize","mercury:panels:hide":"hide","mousedown .mercury-panel-title em":"prevent","mousedown .mercury-panel-title":"startDrag","click .mercury-panel-title em":"hide"},r.prototype.primaryTemplate="panel",r.prototype.releaseOnHide=!1,r.prototype.setWidth=function(t){return this.css({width:t})},r.prototype.resize=function(t,e){var i,n,r;return null==t&&(t=!0),null==e&&(e=null),this.visible?(clearTimeout(this.showContentTimeout),"object"==typeof t&&(e=t,t=!1),t||this.addClass("mercury-no-animation"),(e||(e=null!=(r=Mercury["interface"])?"function"==typeof r.dimensions?r.dimensions():void 0:void 0))&&(this.css({top:e.top+10,bottom:e.bottom+10}),this.$el.outerWidth()+this.$el.offset().left>=e.width-10&&this.css({left:""})),n=this.$titleContainer.outerHeight(),i=this.$el.height(),this.$contentContainer.css({height:i-n}),t?this.showContentTimeout=this.delay(300,this.showContent):this.showContent(!1),this.removeClass("mercury-no-animation")):void 0},r.prototype.onShow=function(){return this.delay(1,this.resize),Mercury.trigger("panels:hide")},r.prototype.onHide=function(){return Mercury.trigger("focus")},r.prototype.focusFirstFocusable=function(){},r.prototype.keepFocusConstrained=function(){},r.prototype.setPositionOnDrag=function(t){return 10>t&&(t=10),t>=this.viewportSize.width-this.$el.outerWidth()-10?this.css({left:""}):this.css({left:t})},r}(Mercury.Modal)}.call(this),function(){var t,e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var r in i)e.call(i,r)&&(t[r]=i[r]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Mercury.Statusbar=function(e){function n(){return t=n.__super__.constructor.apply(this,arguments)}return i(n,e),n.logPrefix="Mercury.Statusbar:",n.className="mercury-statusbar",n.template="statusbar",n.elements={path:".mercury-statusbar-path"},n.events={"mercury:interface:hide":"hide","mercury:interface:show":"show","mercury:region:update":"onRegionUpdate",mousedown:"onMousedown"},n.prototype.build=function(){return this.setPath()},n.prototype.setPath=function(t){var e,i,n,r;for(null==t&&(t=[]),this.$path.html("<b>"+this.t("Path:")+" </b>"),r=[],i=0,n=t.length;n>i;i++)e=t[i],this.$path.append(e),e!==t[t.length-1]?r.push(this.$path.append(" &raquo; ")):r.push(void 0);return r},n.prototype.show=function(){var t=this;if(!Mercury["interface"].floating||!this.visible)return clearTimeout(this.visibilityTimeout),this.visible=!0,this.$el.show(),this.visibilityTimeout=this.delay(50,function(){return t.css({bottom:0})})},n.prototype.hide=function(){var t=this;if(!Mercury["interface"].floating)return clearTimeout(this.visibilityTimeout),this.visible=!1,this.css({bottom:-this.$el.height()}),this.visibilityTimeout=this.delay(250,function(){return t.$el.hide()})},n.prototype.height=function(){return this.$el.outerHeight()},n.prototype.onMousedown=function(t){return this.prevent(t),Mercury.trigger("dialogs:hide"),Mercury.trigger("focus")},n.prototype.onRegionUpdate=function(t){var e;return(e="function"==typeof t.path?t.path():void 0)?this.setPath(e):void 0},n}(Mercury.View)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,i){function n(){this.constructor=e}for(var r in i)t.call(i,r)&&(e[r]=i[r]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e},i=[].slice;Mercury.ToolbarButton=function(t){function n(t,e,i){this.name=t,this.label=e,this.options=null!=i?i:{},this.determineAction(),this.determineTypes(),n.__super__.constructor.call(this,this.options),this.handleSpecial()}return e(n,t),n.logPrefix="Mercury.ToolbarButton:",n.className="mercury-toolbar-button",n.events={mousedown:"indicate",mouseup:"deindicate",mouseout:"deindicate",click:"triggerAction","mercury:region:focus":"onRegionFocus","mercury:region:action":"onRegionUpdate","mercury:region:update":"onRegionUpdate"},n.prototype.standardOptions=["title","icon","action","global","button","settings"],n.create=function(t,e,i){var n;return null==i&&(i={}),i.button&&(n=Mercury[("toolbar_"+i.button).toCamelCase(!0)])?new n(t,e,i):i.plugin&&(n=Mercury.getPlugin(i.plugin).Button)?new n(t,e,i):new Mercury.ToolbarButton(t,e,i)},n.prototype.determineAction=function(){return this.action=this.options.action||this.name,"string"==typeof this.action&&(this.action=[this.action]),this.actionName=this.action[0]},n.prototype.determineTypes=function(){var t,e,i;if(this.types=[],this.options.type)return this.types=[this.options.type];i=this.options;for(t in i)e=i[t],-1===this.standardOptions.indexOf(t)&&this.types.push(t);return this.type=this.types[0]},n.prototype.build=function(){var t;return this.registerPlugin(),this.attr("data-type",this.type),this.attr("data-icon",Mercury.Toolbar.icons[this.icon||this.name]||this.icon),this.options.title&&this.attr("title",this.t(this.options.title)),this.addClass("mercury-toolbar-"+this.name.toDash()+"-button"),this.html("<em>"+this.t(this.label)+"</em>"),null!=(t=this.buildSubview())?t.appendTo(this):void 0},n.prototype.handleSpecial=function(){return"save"===this.event&&this.makeSaveButton(),this.mode?this.makeModeButton():void 0},n.prototype.makeSaveButton=function(){return this.delegateEvents({"mercury:save":function(){return this.addClass("mercury-loading-indicator")},"mercury:save:complete":function(){return this.removeClass("mercury-loading-indicator")}})},n.prototype.makeModeButton=function(){return this.delegateEvents({"mercury:mode":function(t){return t===this.mode?this.isToggled?this.untoggled():this.toggled():void 0}})},n.prototype.registerPlugin=function(){return this.plugin?(this.plugin=Mercury.getPlugin(this.plugin,!0),this.plugin.buttonRegistered(this)):void 0},n.prototype.buildSubview=function(){var t,e,i=this;return this.subview?(this.subview.on("show",function(){return i.toggle&&i.toggled(),i.activate()}),this.subview.on("hide",function(){return i.untoggled(),i.deactivate()}),this.subview):(t=Mercury[("toolbar_"+this.type).toCamelCase(!0)])?(e=this.options[this.type],"string"==typeof e&&(e={template:e}),this.subview=new t(e)):void 0},n.prototype.triggerAction=function(){return this.isDisabled()||(this.toggle&&(this.isToggled?this.untoggled():this.toggled()),this.subview&&(this.subview.visible?this.deactivate():this.activate(),this.subview.toggle()),this.trigger("click"),this.plugin||this.subview)?void 0:(this.event&&Mercury.trigger(this.event),this.mode&&Mercury.trigger("mode",this.mode),Mercury.trigger.apply(Mercury,["action"].concat(i.call(this.action))))},n.prototype.release=function(){var t;return null!=(t=this.subview)&&t.release(),n.__super__.release.apply(this,arguments)},n.prototype.regionSupported=function(t){return this.plugin?this.plugin.regionSupported(t):t.hasAction(this.actionName)},n.prototype.onRegionFocus=function(t){var e=this;return this.delay(100,function(){return e.onRegionUpdate(t)})},n.prototype.onRegionUpdate=function(t){var e;if(t===Mercury["interface"].region)return(null!=(e=this.subview)?e.visible:void 0)||this.deactivate(),this.global||this.regionSupported(t)?(this.enable(),t.hasContext(this.name,!0)===!0?this.activate():void 0):this.disable()},n.prototype.get=function(t){return this[t]},n.prototype.set=function(t,e){var i,n;i={},"object"==typeof t?i=t:i[t]=e,n=[];for(t in i)e=i[t],n.push(this[t]=e);return n},n.prototype.toggled=function(){return this.isToggled=!0,this.addClass("mercury-button-toggled")},n.prototype.untoggled=function(){return this.isToggled=!1,this.removeClass("mercury-button-toggled")},n.prototype.activate=function(){return this.isActive=!0,this.addClass("mercury-button-active")},n.prototype.deactivate=function(){return this.isActive=!1,this.removeClass("mercury-button-active")},n.prototype.enable=function(){return this.isEnabled=!0,this.removeClass("mercury-button-disabled")},n.prototype.disable=function(){return this.isEnabled=!1,this.addClass("mercury-button-disabled")},n.prototype.indicate=function(t){var e;return this.isIndicated=!0,this.isDisabled()?void 0:(t&&(null!=(e=this.subview)?e.visible:void 0)&&(this.deactivate(),this.prevent(t,!0)),this.addClass("mercury-button-pressed"))},n.prototype.deindicate=function(){return this.isIndicated=!1,this.removeClass("mercury-button-pressed")},n.prototype.isDisabled=function(){return!(this.isEnabled!==!1&&!this.$el.closest(".mercury-button-disabled").length)},n}(Mercury.View)}.call(this),function(){var t,e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var r in i)e.call(i,r)&&(t[r]=i[r]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Mercury.ToolbarSelect=function(e){function n(){return t=n.__super__.constructor.apply(this,arguments)}return i(n,e),n.include(Mercury.View.Modules.InterfaceFocusable),n.include(Mercury.View.Modules.ToolbarDialog),n.include(Mercury.View.Modules.VisibilityToggleable),n.logPrefix="Mercury.ToolbarSelect:",n.className="mercury-dialog mercury-toolbar-select",n.prototype.hidden=!0,n}(Mercury.View)}.call(this),function(){var t,e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var r in i)e.call(i,r)&&(t[r]=i[r]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Mercury.ToolbarExpander=function(e){function n(){return t=n.__super__.constructor.apply(this,arguments)}return i(n,e),n.logPrefix="Mercury.ToolbarExpander:",n.className="mercury-toolbar-expander",n.events={"mercury:interface:resize":"onResize",mousedown:"preventStop",click:"toggleExpander","click li":"onClickForButton"},n.prototype.build=function(){return this.select=this.appendView(new Mercury.ToolbarSelect)},n.prototype.show=function(){return this.visible?void 0:(this.visible=!0,this.$el.show())},n.prototype.hide=function(){return this.visible?(this.visible=!1,this.$el.hide()):void 0},n.prototype.toggleExpander=function(t){return this.visible?(this.prevent(t,!0),this.updateSelect(),this.select.visible||Mercury.trigger("dialogs:hide"),this.select.toggle()):void 0},n.prototype.updateSelect=function(){var t,e,i,n,r,o;for(this.select.html("<ul>"),e=this.select.$("ul"),r=this.parent.hiddenButtons(),o=[],i=0,n=r.length;n>i;i++)t=r[i],o.push(e.append($("<li data-icon='"+t.icon+"'>"+t.title+"</li>").data({button:t.el})));return o},n.prototype.onClickForButton=function(t){return this.prevent(t),$($(t.target).closest("li").data("button")).click()},n.prototype.onResize=function(){return this.parent.el.scrollHeight>this.parent.$el.height()+10?this.show():this.hide(),this.select.visible?this.updateSelect():void 0},n}(Mercury.View)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,i){function n(){this.constructor=e}for(var r in i)t.call(i,r)&&(e[r]=i[r]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e},i=[].slice;Mercury.ToolbarItem=function(t){function n(t,e,i,r){this.name=null!=t?t:"unknown",this.type=null!=e?e:"unknown",this.value=null!=i?i:null,this.expander=null!=r?r:!1,n.__super__.constructor.call(this)}return e(n,t),n.logPrefix="Mercury.ToolbarItem:",n.prototype.build=function(){var t,e,i;if(this.addClasses(),"object"==typeof this.value){i=this.value;for(t in i)e=i[t],this.buildSubview(t,e);return"group"===this.type&&this.buildSubview("sep-final","-"),"container"===this.type&&this.expander?this.buildExpander():void 0}},n.prototype.buildSubview=function(t,e){var n;return n=function(){var n;switch($.isArray(e)?"array":typeof e){case"object":return new Mercury.ToolbarItem(t,"group",e);case"string":return new Mercury.ToolbarItem(t,"separator",e);case"array":return(n=Mercury.ToolbarButton).create.apply(n,[t].concat(i.call(e)))}}(),n?this.appendView(n):void 0},n.prototype.buildExpander=function(){return this.appendView(new Mercury.ToolbarExpander({parent:this}))},n.prototype.addClasses=function(){var t;return t="mercury-toolbar-"+this.type.toDash(),"-"===this.value&&(t="mercury-toolbar-line-"+this.type.toDash()),this.addClass(["mercury-toolbar-"+this.name.toDash()+"-"+this.type.toDash(),t].join(" "))},n.prototype.hiddenButtons=function(){var t,e,i,n,r,o,s,a;for(n=this.$el.height(),e=[],a=this.$(".mercury-toolbar-button"),o=0,s=a.length;s>o;o++)t=a[o],i=$(t),r=i.position().top,r>=n&&e.push({title:i.find("em").html(),icon:i.data("icon"),el:i});return e},n}(Mercury.View)}.call(this),function(){var t,e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var r in i)e.call(i,r)&&(t[r]=i[r]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Mercury.Toolbar=function(e){function n(){return t=n.__super__.constructor.apply(this,arguments)}return i(n,e),n.logPrefix="Mercury.Toolbar:",n.className="mercury-toolbar",n.elements={toolbar:".mercury-toolbar-secondary-container"},n.events={"mercury:interface:hide":"hide","mercury:interface:show":"show","mercury:region:focus":"onRegionFocus",mousedown:"onMousedown",click:"preventStop"},n.prototype.build=function(){return this.append(new Mercury.ToolbarItem("primary","container",this.config("toolbars:primary"),!0)),this.append(new Mercury.ToolbarItem("secondary","container",{}))},n.prototype.buildToolbar=function(t){return this.appendView(this.$toolbar,new Mercury.ToolbarItem(t,"collection",this.config("toolbars:"+t)))},n.prototype.show=function(){var t=this;if(!Mercury["interface"].floating||!this.visible)return clearTimeout(this.visibilityTimeout),this.visible=!0,this.$el.show(),this.visibilityTimeout=this.delay(50,function(){return t.css({top:0})})},n.prototype.hide=function(){var t=this;if(!Mercury["interface"].floating)return clearTimeout(this.visibilityTimeout),this.visible=!1,this.css({top:-this.$el.height()}),this.visibilityTimeout=this.delay(250,function(){return t.$el.hide()})},n.prototype.height=function(){return Mercury["interface"].visible?this.$el.outerHeight():0},n.prototype.onMousedown=function(t){return this.prevent(t),Mercury.trigger("dialogs:hide"),Mercury.trigger("focus")},n.prototype.onRegionFocus=function(t){var e,i,n,r;if(this.region!==t){for(this.region=t,this.$(".mercury-toolbar-collection").remove(),this.releaseSubviews(),r=t.toolbars||[],i=0,n=r.length;n>i;i++)e=r[i],this.buildToolbar(e);return Mercury.trigger("region:update",t)}},n.icons={save:"A",preview:"B",undo:"C",redo:"D",link:"J",file:"K",table:"L",character:"M",snippets:"N",history:"O",notes:"P",upload:"X",search:"Y",bold:"b",italic:"c",strike:"d",underline:"e",subscript:"f",superscript:"g",justifyLeft:"h",justifyCenter:"i",justifyRight:"j",justifyFull:"k",unorderedList:"l",orderedList:"m",outdent:"n",indent:"o",rule:"p",h1:"q",h2:"r",h3:"s",h4:"t",h5:"u",h6:"v",removeHeading:"w",blockquote:"x",clean:"y",edit:"z",pre:"z",rowBefore:"0",rowAfter:"1",rowDelete:"2",colBefore:"3",colAfter:"4",colDelete:"5",colIncrease:"6",colDecrease:"7",rowIncrease:"8",rowDecrease:"9",alignLeft:'"',alignRight:"'",alignTop:"?",alignMiddle:"!",alignBottom:"@",alignNone:"_",crop:"*",resize:"#",prev:"$",next:"%",remove:"y",togglePlay:"&",fav:"^",softWrap:"`",direction:"{",calculate:"|",user:"}",brightness:"~"},n}(Mercury.View)}.call(this),function(){var t,e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var r in i)e.call(i,r)&&(t[r]=i[r]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Mercury.ToolbarPalette=function(e){function n(){return t=n.__super__.constructor.apply(this,arguments)}return i(n,e),n.include(Mercury.View.Modules.InterfaceFocusable),n.include(Mercury.View.Modules.ToolbarDialog),n.include(Mercury.View.Modules.VisibilityToggleable),n.logPrefix="Mercury.ToolbarPalette:",n.className="mercury-dialog mercury-toolbar-palette",n.prototype.hidden=!0,n}(Mercury.View)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,i){function n(){this.constructor=e}for(var r in i)t.call(i,r)&&(e[r]=i[r]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};Mercury.Model.File=function(t){function i(t,e){this.file=t,this.options=null!=e?e:{},i.__super__.constructor.call(this,{name:this.file.name,type:this.file.type,size:this.file.size,url:this.file.url||null})}return e(i,t),i.define("Mercury.Model.File"),i.url=function(){return this.config("uploading:saveUrl")},i.prototype.validate=function(){var t,e;return this.get("size")>=this.config("uploading:maxSize")?(this.addError("size",this.t("Too large (max %s)",this.config("uploading:maxSize").toBytes())),void 0):(t=null!=(e=this.options.mimeTypes)?e:this.config("uploading:mimeTypes"),t&&t.indexOf(this.get("type"))<=-1?this.addError("type",this.t("Unsupported format (%s)",this.get("type"))):void 0)},i.prototype.readAsDataURL=function(t){var e;if(window.FileReader)return e=new FileReader,e.onload=function(){return t?t(e.result):void 0},e.readAsDataURL(this.file)},i.prototype.readableSize=function(){return this.get("size").toBytes()},i.prototype.isImage=function(){return["image/jpeg","image/gif","image/png"].indexOf(this.get("type"))>-1},i.prototype.save=function(t){var e;return null==t&&(t={}),e={data:this.toFormData(),processData:!1,contentType:!1,dataType:!1,xhr:function(){var e,i,n,r,o;n=$.ajaxSettings.xhr(),o=t.uploadEvents||{},r=function(t,e){return n.upload["on"+t]=e};for(e in o)i=o[e],r(e,i);return n}},i.__super__.save.call(this,$.extend(e,t))},i.prototype.toFormData=function(){var t;if(window.FormData)return t=new FormData,t.append(this.config("uploading:saveName"),this.file,this.get("name")),t},i.prototype.saveSuccess=function(){return this.get("url")?void 0:this.notify(this.t("Unable to process response: %s","no url"))},i}(Mercury.Model)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,i){function n(){this.constructor=e}for(var r in i)t.call(i,r)&&(e[r]=i[r]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};Mercury.Uploader=function(t){function i(t,e){return this.options=null!=e?e:{},this.constructor.supported?(i.__super__.constructor.call(this,this.options),this.loaded=0,this.total=0,this.files=[],this.calculate(t||[]).length&&(this.show(),this.delay(500,this.upload)),void 0):this.notify(this.t("Is unsupported in this browser"))}return e(i,t),i.supported=!(!window.FormData||!(new XMLHttpRequest).upload),i.logPrefix="Mercury.Uploader:",i.className="mercury-uploader",i.template="uploader",i.elements={status:".mercury-uploader-progress span",details:".mercury-uploader-details",preview:".mercury-uploader-preview b",indicator:".mercury-uploader-indicator div",percent:".mercury-uploader-indicator b"},i.prototype.calculate=function(t){var e,i,n;for(i=0,n=t.length;n>i;i++)e=t[i],e=new Mercury.Model.File(e,{mimeTypes:this.mimeTypes}),e.isValid()?(this.files.push(e),this.total+=e.get("size")):alert(this.t("Error uploading %s: %s",e.get("name"),e.errorMessages()));return this.files},i.prototype.build=function(){return this.appendTo(Mercury["interface"])},i.prototype.show=function(){var t=this;return this.update(this.t("Processing...")),this.delay(50,function(){return t.css({opacity:1})})},i.prototype.release=function(t){return null==t&&(t=0),this.delay(t,function(){return this.css({opacity:0}),this.delay(250,function(){return i.__super__.release.apply(this,arguments)})})},i.prototype.upload=function(){var t,e=this;return this.files.length?(this.file=this.files.shift(),this.update(this.t("Uploading...")),this.loadDetails(),(t=this.file.save({uploadEvents:this.uploadEvents()}))?(t.success(function(){return e.success()}),t.error(function(){return e.error()})):void 0):this.release(500)},i.prototype.update=function(t,e){var i;return null==e&&(e=0),i=Math.floor(100*(this.loaded+e)/this.total)+"%",t&&this.$status.html(t),this.$indicator.css({width:i}),this.$percent.html(i)},i.prototype.loadDetails=function(){var t=this;return this.$details.html([this.t("Name: %s",this.file.get("name")),this.t("Type: %s",this.file.get("type")),this.t("Size: %s",this.file.readableSize())].join("<br/>")),this.file.isImage()?this.file.readAsDataURL(function(e){return t.$preview.html($("<img>",{src:e}))}):void 0},i.prototype.success=function(){return this.trigger("uploaded",this.file),this.loaded+=this.file.get("size"),this.update(this.t("Successfully uploaded...")),this.upload()},i.prototype.error=function(){return this.update(this.t("Error: Unable to upload the file")),this.delay(3e3,this.upload)},i.prototype.uploadEvents=function(){var t=this;return{progress:function(e){return t.update(t.t("Uploading..."),e.loaded),t.$percent.show()}}},i}(Mercury.View)}.call(this),function(){var t,e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var r in i)e.call(i,r)&&(t[r]=i[r]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Mercury.Action.Image=function(e){function n(){return t=n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.name="image",n.prototype.asHtml=function(){return'<img src="'+this.get("url")+'">'},n}(Mercury.Action)}.call(this),function(){var t,e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var r in i)e.call(i,r)&&(t[r]=i[r]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Mercury.Action.Link=function(e){function n(){return t=n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.name="link",n.prototype.asMarkdown=function(){return"["+this.get("text")+"]("+this.get("url")+")"},n.prototype.asHtml=function(){var t;return t=this.get("target")?' target="'+this.get("target")+'"':"",'<a href="'+this.get("url")+'"'+t+">"+this.get("text")+"</a>"},n}(Mercury.Action)}.call(this),function(){var t,e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var r in i)e.call(i,r)&&(t[r]=i[r]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};Mercury.Action.Table=function(e){function n(){return t=n.__super__.constructor.apply(this,arguments)}return i(n,e),n.prototype.name="table",n.prototype.asHtml=function(){var t;return t=this.attributes,t.asHtml("<br />")},n}(Mercury.Action)}.call(this),function(){Mercury.Region.Modules.ContentEditable={included:function(){return this.on("build",this.buildContentEditable),this.on("preview",this.toggleContentEditable),this.on("release",this.releaseContentEditable)},buildContentEditable:function(){var t;return null==(t=this.editableDropBehavior)&&(this.editableDropBehavior=!0),this.document||(this.document=this.$el.get(0).ownerDocument),this.makeContentEditable(),this.forceContentEditableDisplay(),this.setContentEditablePreferences()},toggleContentEditable:function(){return this.previewing?this.makeNotContentEditable():this.makeContentEditable()},releaseContentEditable:function(){return this.makeNotContentEditable(),this.originalDisplay?this.css({display:this.originalDisplay}):void 0},makeContentEditable:function(){return this.$el.get(0).contentEditable=!0},makeNotContentEditable:function(){return this.$el.get(0).contentEditable=!1},forceContentEditableDisplay:function(){return"inline"===this.css("display")?(this.originalDisplay="inline",this.css({display:"inline-block"})):void 0},setContentEditablePreferences:function(){try{return this.document.execCommand("styleWithCSS",!1,!1),this.document.execCommand("insertBROnReturn",!1,!0),this.document.execCommand("enableInlineTableEditing",!1,!1),this.document.execCommand("enableObjectResizing",!1,!1)}catch(t){}},stackEquality:function(t){return 0===this.stackPosition&&this.stack[this.stackPosition]?JSON.stringify(this.stack[this.stackPosition].val)===JSON.stringify(t.val):JSON.stringify(this.stack[this.stackPosition])===JSON.stringify(t)}}}.call(this),function(){Mercury.Region.Modules.DropIndicator={included:function(){return this.on("build",this.buildDropIndicator),this.on("release",this.releaseDropIndicator)},buildDropIndicator:function(){return this.$el.after(this.$dropIndicator=$('<div class="mercury-region-drop-indicator"></div>')),this.delegateEvents({dragenter:"showDropIndicator",dragover:"showDropIndicator",dragleave:"hideDropIndicator",drop:"hideDropIndicator"})
},releaseDropIndicator:function(){return this.$dropIndicator.remove()},dropIndicatorPosition:function(){var t;return t=this.$el.position(),{top:t.top+this.$el.outerHeight()/2,left:t.left+this.$el.outerWidth()/2,display:"block"}},showDropIndicator:function(){var t=this;return clearTimeout(this.dropIndicatorTimeout),this.previewing||this.dropIndicatorVisible||Mercury.dragHack&&!this.onDropSnippet||!(Mercury.dragHack||this.onDropItem||this.onDropFile)?void 0:(this.dropIndicatorVisible=!0,this.$dropIndicator.css(this.dropIndicatorPosition()),this.$dropIndicator.removeClass("mercury-region-snippet-drop-indicator"),Mercury.dragHack&&this.$dropIndicator.addClass("mercury-region-snippet-drop-indicator"),this.delay(50,function(){return t.$dropIndicator.css({opacity:1})}))},hideDropIndicator:function(){return clearTimeout(this.dropIndicatorTimeout),this.dropIndicatorTimeout=this.delay(250,function(){var t=this;return this.dropIndicatorVisible=!1,this.$dropIndicator.css({opacity:0}),this.dropIndicatorTimeout=this.delay(251,function(){return t.$dropIndicator.hide()})})}}}.call(this),function(){Mercury.Region.Modules.DropItem={onDropItem:function(t,e){var i,n,r;return r=this.getActionAndUrlFromData(e),i=r[0],(n=r[1])?(this.prevent(t),this.focus(),this.handleAction(i,{url:n})):void 0},getActionAndUrlFromData:function(t){var e,i;return e="image",(t.getData("text/html")||Mercury.support.safari&&-1===(t.types||[]).indexOf("image/tiff"))&&(e="link"),(i=$("<div>").html(t.getData("text/html")).find("img").attr("src"))&&(e="image"),[e,i||t.getData("text/uri-list")]}}}.call(this),function(){Mercury.Region.Modules.FocusableTextarea={included:function(){return this.on("build",this.buildFocusable),this.on("action",this.resizeFocusable),this.on("preview",this.toggleFocusablePreview),this.on("release",this.releaseFocusable)},buildFocusable:function(){var t,e,i;return null==(i=this.editableDropBehavior)&&(this.editableDropBehavior=!0),e=this.originalContent(),t=this.options.autoSize?"none":"vertical",this.$preview=$('<div class="mercury-'+this.constructor.type+'-region-preview">'),this.$focusable=$('<textarea class="mercury-'+this.constructor.type+'-region-textarea" placeholder="'+this.placeholder+'">'),this.options.wrapping||this.$focusable.attr({wrap:"off"}),this.$el.empty(),this.append(this.$preview,this.$focusable.css({width:"100%",height:this.$el.height()||this.height||20,resize:t})),this.value(e),this.delay(1,this.resizeFocusable),this.delegateEvents({"keydown textarea":"handleKeyEvent"})},originalContent:function(){return this.html().replace("&gt;",">").replace("&lt;","<").trim()},releaseFocusable:function(){var t;return this.html(null!=(t="function"==typeof this.convertedValue?this.convertedValue():void 0)?t:this.value())},value:function(t){var e;return null==t&&(t=null),null===t||"undefined"==typeof t?this.$focusable.val():(this.$focusable.val(null!=(e=t.val)?e:t),t.sel?this.setSerializedSelection(t.sel):void 0)},resizeFocusable:function(){var t,e,i;if(this.options.autoSize)return i=this.$focusable.get(0),t=$("body",this.el.ownerDocument),e=t.scrollTop(),this.$focusable.css({height:1}).css({height:i.scrollHeight}),t.scrollTop(e)},toggleFocusablePreview:function(){return this.previewing?(this.$focusable.hide(),this.$preview.html(("function"==typeof this.convertedValue?this.convertedValue():void 0)||this.value()).show()):(this.$preview.hide(),this.$focusable.show())},handleKeyEvent:function(t){if(!(t.keyCode>=37&&t.keyCode<=40||(this.delay(1,this.resizeFocusable),t.metaKey&&90===t.keyCode))){if(13===t.keyCode&&"function"==typeof this.onReturnKey&&this.onReturnKey(t),t.metaKey)switch(t.keyCode){case 66:return this.prevent(t),this.handleAction("bold");case 73:return this.prevent(t),this.handleAction("italic");case 85:return this.prevent(t),this.handleAction("underline")}return this.resizeFocusable(),this.pushHistory(t.keyCode)}}}}.call(this),function(){Mercury.Region.Modules.HtmlSelection={getSelection:function(){return rangy.getSelection()},getSerializedSelection:function(){return rangy.serializeSelection()},setSerializedSelection:function(t){return rangy.deserializeSelection(t)},toggleWrapSelectedWordsInClass:function(t,e){var i;return null==e&&(e={}),e=$.extend({},{normalize:!0},e,{applyToEditableOnly:!0}),i=rangy.createCssClassApplier(t,e),i.toggleSelection()},replaceSelection:function(t){var e,i,n,r,o;for(("string"==typeof t||t.is)&&(t=this.elementFromValue(t)),r=this.getSelection().getAllRanges(),o=[],i=0,n=r.length;n>i;i++)e=r[i],e.deleteContents(),o.push(e.insertNode(t));return o},elementFromValue:function(t){return t.is?t.get(0):$(t).get(0)}}}.call(this),function(){Mercury.Region.Modules.SelectionValue={toStack:function(){return{val:this.toJSON(),sel:"function"==typeof this.getSerializedSelection?this.getSerializedSelection():void 0}},fromStack:function(t){return t?(this.fromJSON(t.val),t.sel?"function"==typeof this.setSerializedSelection?this.setSerializedSelection(t.sel):void 0:void 0):void 0}}}.call(this),function(){Mercury.Region.Modules.Snippetable={included:function(){return this.on("action",this.restoreSnippets)},restoreSnippets:function(){var t,e,i,n,r;for(r=this.$("[data-mercury-snippet]"),i=0,n=r.length;n>i;i++)e=r[i],t=$(e),t.data("snippet")||Mercury.Snippet.find(t.data("mercury-snippet")).replaceWithView(t);return"function"==typeof this.onLoadSnippet?this.onLoadSnippet():void 0},snippets:function(){var t,e,i,n,r,o;for(i={},o=this.$("[data-mercury-snippet]"),n=0,r=o.length;r>n;n++)t=o[n],e=Mercury.Snippet.find($(t).data("mercury-snippet")),i[e.cid]=e.toJSON();return i},loadSnippets:function(t){var e,i,n;null==t&&(t={}),this.clearStack(),n=[];for(e in t)i=t[e],n.push(this.loadSnippet(e,i));return n},loadSnippet:function(t,e){var i=this;return Mercury.Snippet.fromSerializedJSON(e).renderAndReplaceWithView(this.$("[data-mercury-snippet="+t+"]"),function(){try{return i.initialValue=JSON.stringify(i.toJSON()),i.pushHistory(),"function"==typeof i.onLoadSnippet?i.onLoadSnippet():void 0}catch(t){}})}}}.call(this),function(){var t=[].slice;Mercury.Region.Modules.TextSelection={getSelection:function(){var t,e,i,n;return t=this.$focusable.get(0),n=t.value,i=t.selectionStart,e=t.selectionEnd,{start:i,end:e,length:e-i,text:n.slice(i,e)}},setSelection:function(t,e,i,n){var r,o,s,a;return null==e&&(e=0),null==i&&(i=null),null==n&&(n=!1),s=t.start+e,o=t.end+(null!=i?i:e),(s>o||"undefined"==typeof o||n)&&(o=s),r=this.$focusable.get(0),a=r.value,0>s&&(s+=a.length),0>o&&(o+=a.length),r.selectionStart=s,r.selectionEnd=o},getSerializedSelection:function(){return this.getSelection()},setSerializedSelection:function(t){return this.setSelection(t)},isWithinToken:function(t){var e,i,n,r;return r=this.getTokenAndSelection(t),i=r[0],n=r[1],e=this.expandSelectionToTokens(n,i),e.cleaned?!0:void 0},isWithinLineToken:function(t){var e,i,n,r,o;return o=this.getTokenAndSelection(t),i=o[0],n=o[1],e=this.expandSelectionToLines(n),r=e.text.match(i.regexp),r&&2===r.length?!0:!1},firstLineMatches:function(t){var e,i;return i=this.getSelection(),e=this.expandSelectionToLines(i),e.text.match(t)?!0:void 0},paragraphMatches:function(t){var e,i;return i=this.getSelection(),e=this.expandSelectionToParagraphs(i),e.text.match(t)?!0:void 0},replaceSelection:function(t){var e,i,n,r;return null==t&&(t=""),i=this.$focusable.get(0),r=i.value,n=this.getSelection(),i.value=[r.slice(0,n.start),t,r.slice(n.end)].join(""),e=n.start+t.length,this.setSelection({start:e,end:e})},replaceSelectedLine:function(t,e){return null==e&&(e=""),this.setSelection(t),this.replaceSelection(e)},setAndReplaceSelection:function(t,e,i,n,r,o){return null==e&&(e=""),this.setSelection(t),this.replaceSelection(e),this.setSelection(i,n,r,o)},replaceSelectionWithParagraph:function(t){var e,i,n,r;return null==t&&(t=""),r=this.value(),i=this.getSelection(),e="\n","\n"!==r[i.start-1]&&(e+="\n"),i.start||(e=""),n="\n","\n"!==r[i.end]&&"\n"!==r[i.end+1]&&(n+="\n"),i.end||(n="\n\n"),this.replaceSelection([e,t,n].join(""))},wrapSelected:function(t,e){var i,n,r,o,s,a,l,u;return null==e&&(e={}),a=this.getTokenAndSelection(t),i=a[0],r=a[1],s=[i.pre,r.text||e.text||"",i.suf].join(""),"end"===e.select?(l=[s.length,null],n=l[0],o=l[1]):(u=[0,s.length-r.length],n=u[0],o=u[1]),this.setAndReplaceSelection(r,s,r,n,o,"end"===e.select)},unwrapSelected:function(t){var e,i,n,r;return r=this.getTokenAndSelection(t),e=r[0],i=r[1],n=i.text.match(e.regexp),n&&2===n.length?this.setAndReplaceSelection(i,i.text.replace(e.regexp,""),i,0,-n.join("").length):!1},toggleWrapSelected:function(t,e){return null==e&&(e={}),this.unwrapSelected(t)?void 0:this.wrapSelected(t,e)},wrapSelectedWords:function(t){var e,i,n,r;return r=this.getTokenAndSelection(t),i=r[0],n=r[1],e=this.expandSelectionToWords(n),this.setAndReplaceSelection(e,[i.pre,e.text,i.suf].join(""),n,i.pre.length)},unwrapSelectedWords:function(t){var e,i,n,r;return r=this.getTokenAndSelection(t),i=r[0],n=r[1],e=this.expandSelectionToTokens(n,i),e.cleaned?this.setAndReplaceSelection(e,e.token,n,-e.match[0].length):!1},toggleWrapSelectedWords:function(t){return this.unwrapSelectedWords(t)?void 0:this.wrapSelectedWords(t)},wrapSelectedLines:function(t){var e,i,n,r,o,s,a,l,u,c,h,p,d;for(d=this.getTokenAndSelection(t),r=d[0],l=d[1],n=this.expandSelectionToLines(l),a=0,u=0,c=[],s=n.start,e=n.text.split("\n"),h=0,p=e.length;p>h;h++)o=e[h],o.trim()||1===e.length?(a||(a=r.pre.length),u+=r.pre.length,s+=o.length,s<l.end&&(u+=r.suf.length),c.push([r.pre,o,r.suf].join(""))):(i=!0,s+=o.length,c.push(o));return i&&(a=0),this.setAndReplaceSelection(n,c.join("\n"),l,a,u)},unwrapSelectedLines:function(t){var e,i,n,r,o,s,a,l,u,c,h,p,d,f;for(f=this.getTokenAndSelection(t),n=f[0],l=f[1],i=this.expandSelectionToLines(l),s=0,c=0,h=[],o=i.start,e=i.text.split("\n"),a=!0,p=0,d=e.length;d>p;p++)r=e[p],u=r.match(n.regexp),u&&2===u.length?(o<=l.start&&(s+=u[0].length),o<l.end&&(c+=u[0].length),o+=r.length,o<=l.start&&(s+=u[1].length),o<l.end&&(c+=u[1].length),h.push(r.replace(n.regexp,""))):(a=!1,o+=r.length,h.push(r));return a||(s=0),this.setAndReplaceSelection(i,h.join("\n"),l,-s,-c),a},wrapSelectedParagraphs:function(t,e){var i,n,r,o,s,a,l,u,c,h,p,d,f;if(null==e&&(e={}),f=this.getTokenAndSelection(t),o=f[0],u=f[1],r=this.expandSelectionToParagraphs(u),l=0,c=0,h=[],a=r.start,e.all)l=c+=o.pre.length,h.push([o.pre,r.text,o.suf].join(""));else{for(i=r.text.split("\n"),p=0,d=i.length;d>p;p++)s=i[p],s.trim()||1===i.length?(a<=u.start&&(l+=o.pre.length),a<u.end&&(c+=o.pre.length),a+=s.length,a<=u.start&&(l+=o.suf.length),a<u.end&&(c+=o.suf.length),h.push([o.pre,s,o.suf].join(""))):(n=!0,a+=s.length,h.push(s));n&&(l=0)}return this.setAndReplaceSelection(r,h.join("\n"),u,l,c)},unwrapSelectedParagraphs:function(t,e){var i,n,r,o,s,a,l,u,c,h,p,d,f,g;if(null==e&&(e={}),f=this.getTokenAndSelection(t),n=f[0],l=f[1],i=this.expandSelectionToParagraphs(l),s=0,c=0,h=[],o=i.start,a=!0,e.all)u=i.text.match(n.regexp),u&&2===u.length?(s+=u[0].length,c+=u[1].length,h.push(i.text.replace(n.regexp,""))):h.push(i.text);else{for(g=i.text.split("\n"),p=0,d=g.length;d>p;p++)r=g[p],u=r.match(n.regexp),u&&2===u.length?(o<=l.start&&(s+=u[0].length),o<l.end&&(c+=u[0].length),o+=r.length,o<=l.start&&(s+=u[1].length),o<l.end&&(c+=u[1].length),h.push(r.replace(n.regexp,""))):(a=!1,o+=r.length,h.push(r));a||(s=0)}return this.setAndReplaceSelection(i,h.join("\n"),l,-s,-c),a},expandSelectionToWords:function(t){var e,i,n,r,o;return o=this.value(),this.selectionIsEmptyLine(t,o)||this.selectionIsEndOfLine(t,o)?t:(n=this.getSelectionStartOfLine(t,o),i=this.getSelectionEndOfLine(t,o),r=o.lastIndexOf(" ",t.start-1),n>r&&(r=n),r>0&&(" "===o[r]||"\n"===o[r])&&(r+=1),e=o.indexOf(" ",t.end),(e>=i||-1===e)&&(e=i),{start:r,end:e,text:o.substring(r,e),length:e-r})},expandSelectionToLines:function(t){var e,i,n;return n=this.value(),this.selectionIsEmptyLine(t,n)?t:(i=this.getSelectionStartOfLine(t,n),e=this.getSelectionEndOfLine(t,n),{start:i,end:e,text:n.substring(i,e),length:e-i})},expandSelectionToParagraphs:function(t){var e,i,n;return n=this.value(),this.selectionIsEmptyLine(t,n)?t:(i=n.lastIndexOf("\n\n",t.start-1),0>i&&(i=0),i>0&&(i+=2),0===i&&"\n"===n[0]&&(i+=1),1===i&&"\n"===n[1]&&(i+=1),i>t.start-1&&(i=t.start),e=n.indexOf("\n\n",t.end-1),t.length&&"\n\n"===n.substr(t.end-2,2)&&(e=t.end),0>e&&(e=n.length),{start:i,end:e,text:n.substring(i,e),length:e-i})},expandSelectionToTokens:function(t,e){var i,n,r,o,s,a,l,u,c;return u=this.value(),this.selectionIsEmptyLine(t,u)?t:(i=this.selectionIsToken(t,u,e))?i:(o=this.getSelectionStartOfLine(t,u),r=this.getSelectionEndOfLine(t,u),a=u.lastIndexOf(e.pre,t.start-1),o>a&&(a=o),a>0&&(" "===u[a]||"\n"===u[a])&&(a+=1),n=u.indexOf(e.suf,t.end-1),n>-1&&(n+=e.suf.length),(n>r||-1===n)&&(n=r),l=null,c=u.substring(a,n),s=c.match(e.regexp),s&&2===s.length&&(l=c.replace(e.regexp,"")),{start:a,end:n,text:c,length:n-a,cleaned:null!==l,token:l,match:s})},selectionIsToken:function(t,e,i){var n,r,o,s,a;return t.length>0?!1:(o=t.start-i.pre.length,n=t.end+i.suf.length,s=null,a=e.substring(o,n),r=a.match(i.regexp),r&&2===r.length&&(s=a.replace(i.regexp,"")),null===s?!1:{start:o,end:n,text:a,length:n-o,cleaned:!0,token:s,match:r})},getSelectionStartOfLine:function(t,e){var i;return i=t.start,"\n"!==e[i]&&(i=e.lastIndexOf("\n",i)),i===t.start&&(i=e.lastIndexOf("\n",i-1)),0>i&&(i=0),0===i&&"\n"===e[0]&&0===t.start?i=0:"\n"===e[i]&&(i+=1),i},getSelectionEndOfLine:function(t,e){var i;return i=t.end,(0===t.length||"\n"!==e[i]&&"\n"!==e[i-1])&&(i=e.indexOf("\n",i)),0>i&&(i=e.length),i},selectionIsEmptyLine:function(t,e){return t.length<=1&&"\n\n"===e.substr(t.start-1,2)||0===t.start&&"\n"===e[0]},selectionIsEndOfLine:function(t,e){return" "===e[t.start-1]&&("\n"===e[t.start]||t.start===e.length)},processWrapper:function(){var e,i,n,r,o;return n=arguments[0],e=2<=arguments.length?t.call(arguments,1):[],i=this.tokenFromWrapper(n),i.pre=(r=i.pre).printf.apply(r,e[0]),i.suf=(o=i.suf).printf.apply(o,e[1]||e[0]),[i.pre,i.suf]},tokenFromWrapper:function(t){var e,i;return"string"==typeof t&&(t=this.wrappers[t]),e=t[0],i=t[1],null==i&&(i=e),{pre:e,suf:i,regexp:t[2]||new RegExp("^"+e.regExpEscape()+"|"+i.regExpEscape()+"$","gi")}},getTokenAndSelection:function(t){return[this.tokenFromWrapper(t),this.getSelection()]}}}.call(this),function(){var t,e=[].slice;t=function(){var t,i,n,r,o,s,a=this;for(this.version="2.0.1 pre alpha",this.JST=window.JST||{},this.init=function(t){return null==t&&(t={}),this["interface"]?void 0:(this.trigger("configure"),this["interface"]=new(this[this.config("interface:class")])(t),this.load(this.loadedJSON||{}),this["interface"])},this.load=function(t){return null==t&&(t={}),this.loadedJSON=t,this["interface"]?(this["interface"].load(this.loadedJSON),delete this.loadedJSON):void 0},this.release=function(){return this["interface"]?(this.trigger("released"),this["interface"].release(),delete this["interface"],this.off()):void 0},this.Module.extend.call(this,this.Config),this.configure=function(){var t,i;return t=1<=arguments.length?e.call(arguments,0):[],this.configuration&&(this.trigger("configure"),(i=this.Config).set.apply(i,t)),this.one("configure",function(){return this.Config.set(t[0],!0,t[1])})},n=["focus","blur","save","initialize","reinitialize","interface:toggle","interface:show","interface:hide"],r=function(t){return a[t.replace("interface:","")]=function(){return this.trigger(t)}},o=0,s=n.length;s>o;o++)t=n[o],r(t);return this.Module.extend.call(this,this.Events),this.Module.extend.call(this,this.I18n),this.Module.extend.call(this,this.Logger),this.Module.extend.call(this,this.Plugin),this.Module.extend.call(this,this.Snippet),this.support={webkit:navigator.userAgent.indexOf("WebKit")>0,safari:navigator.userAgent.indexOf("Safari")>0&&-1===navigator.userAgent.indexOf("Chrome"),chrome:navigator.userAgent.indexOf("Chrome")>0,gecko:navigator.userAgent.indexOf("Firefox")>0,trident:navigator.userAgent.indexOf("MSIE")>0,ie10:(i=navigator.userAgent.match(/MSIE\s([\d|\.]+)/))?parseFloat(i[1],10)>=10:!1},this.support.wysiwyg=document.designMode&&(!this.support.trident||this.support.ie10)&&window.rangy&&window.rangy.supported,this.support.gecko&&parseFloat(navigator.userAgent.match(/Firefox\/([\d|\.]+)/)[1],10)<22?this.support.wysiwyg=!1:void 0},t.call(this.MockMercury||this.Mercury)}.call(this),function(){var t,e,i={}.hasOwnProperty,n=function(t,e){function n(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};t=Mercury.registerPlugin("blocks",{description:"Provides interface for selecting common block elements.",version:"1.0.0",prependButtonAction:"insert",actions:{block:"insert"},config:{blocks:{h1:"Heading 1",h2:"Heading 2",h3:"Heading 3",h4:"Heading 4",h5:"Heading 5",h6:"Heading 6",p:"Paragraph",blockquote:"Blockquote",pre:"Formatted"}},registerButton:function(){return this.button.set({type:"select",subview:this.bindTo(new t.Select)})},bindTo:function(t){var e=this;return t.on("block:picked",function(t){return e.triggerAction(t)})},insert:function(t,e){return Mercury.trigger("action",t,e)}}),t.Select=function(t){function i(){return e=i.__super__.constructor.apply(this,arguments)}return n(i,t),i.prototype.template="blocks",i.prototype.className="mercury-blocks-select",i.prototype.events={"click [data-value]":function(t){return this.trigger("block:picked",$(t.target).closest("li").data("value"))}},i}(Mercury.ToolbarSelect),JST["/mercury/templates/blocks"]=function(){var e,i;return"<ul>"+function(){var n,r;n=t.config("blocks"),r=[];for(e in n)i=n[e],r.push("<li data-value='"+e+"'><"+e+">"+i+"</"+e+"></li>");return r}().join("")+"</ul>"}}.call(this),function(){var t,e,i,n={}.hasOwnProperty,r=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};t=Mercury.registerPlugin("character",{description:"Provides interface for selecting and inserting special characters.",version:"1.0.0",actions:{html:"insertHtml",text:"insertText"},config:{modal:!0,characters:"162 8364 163 165 169 174 8482 8240 181 183 8226 8230 8242 8243 167 182 223 8249 8250 171 187 8216 8217 8220 8221 8218 8222 8804 8805 8211 8212 175 8254 164 166 168 161 191 710 732 176 8722 177 247 8260 215 185 178 179 188 189 190 402 8747 8721 8734 8730 8764 8773 8776 8800 8801 8712 8713 8715 8719 8743 8744 172 8745 8746 8706 8704 8707 8709 8711 8727 8733 8736 180 184 170 186 8224 8225 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 216 338 352 217 218 219 220 221 376 222 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 245 246 248 339 353 249 250 251 252 253 254 255 913 914 915 916 917 918 919 920 921 922 923 924 925 926 927 928 929 931 932 933 934 935 936 937 945 946 947 948 949 950 951 952 953 954 955 956 957 958 959 960 961 962 963 964 965 966 967 968 969 8501 982 8476 977 978 8472 8465 8592 8593 8594 8595 8596 8629 8656 8657 8658 8659 8660 8756 8834 8835 8836 8838 8839 8853 8855 8869 8901 8968 8969 8970 8971 9001 9002 9674 9824 9827 9829 9830 x263F"},registerButton:function(){return this.button.set({type:"character",subview:this.bindTo(this.view())})},view:function(){return this.config("modal")?new t.Modal:new t.Palette},bindTo:function(t){var e=this;return t.on("character:picked",function(t){return e.triggerAction(t)})},insertHtml:function(t,e){return Mercury.trigger("action","html","&#"+e+";")},insertText:function(t,e){return Mercury.trigger("action","text",$("<em>&#"+e+";</em>").html())}}),t.Modal=function(t){function i(){return e=i.__super__.constructor.apply(this,arguments)}return r(i,t),i.prototype.template="character",i.prototype.className="mercury-character-modal",i.prototype.title="Character Picker",i.prototype.hidden=!0,i.prototype.events={"click li":function(t){return this.trigger("character:picked",$(t.target).data("value"))&&this.hide()}},i}(Mercury.Modal),t.Palette=function(t){function e(){return i=e.__super__.constructor.apply(this,arguments)}return r(e,t),e.prototype.template="character",e.prototype.className="mercury-character-palette",e.prototype.hidden=!0,e.prototype.events={"click li":function(t){return this.trigger("character:picked",$(t.target).data("value"))}},e}(Mercury.ToolbarPalette),JST["/mercury/templates/character"]=function(){var e;return"<ul>"+function(){var i,n,r,o;for(r=t.config("characters").split(" "),o=[],i=0,n=r.length;n>i;i++)e=r[i],o.push("<li data-value='"+e+"'>&#"+e+";</li>");return o}().join("")+"</ul>"}}.call(this),function(){var t,e,i={}.hasOwnProperty,n=function(t,e){function n(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};t=Mercury.registerPlugin("color",{description:"Provides interface for selecting colors.",version:"1.0.0",prependButtonAction:"insert",actions:{color:"insert",html:"insert",text:"insert"},config:{colors:"FFFFFF FFCCCC FFCC99 FFFF99 FFFFCC 99FF99 99FFFF CCFFFF CCCCFF FFCCFF CCCCCC FF6666 FF9966 FFFF66 FFFF33 66FF99 33FFFF 66FFFF 9999FF FF99FF C0C0C0 FF0000 FF9900 FFCC66 FFFF00 33FF33 66CCCC 33CCFF 6666CC CC66CC 999999 CC0000 FF6600 FFCC33 FFCC00 33CC00 00CCCC 3366FF 6633FF CC33CC 666666 990000 CC6600 CC9933 999900 009900 339999 3333FF 6600CC 993399 333333 660000 993300 996633 666600 006600 336666 000099 333399 663366 000000 330000 663300 663333 333300 003300 003333 000066 330099 330033"},registerButton:function(){return this.button.set({type:"color",subview:this.bindTo(new t.Palette)})},bindTo:function(t){var e=this;return t.on("color:picked",function(t){return e.triggerAction(t),e.button.css({color:"#"+t})})},regionContext:function(){var t;return(t=this.region.hasContext(this.context,!0)||this.region.hasContext("color",!0))?this.button.css({color:t}):void 0},insert:function(t,e){return Mercury.trigger("action",t,"#"+e)}}),t.Palette=function(t){function i(){return e=i.__super__.constructor.apply(this,arguments)}return n(i,t),i.prototype.template="color",i.prototype.className="mercury-color-palette",i.prototype.events={"click li":function(t){var e;return e=$(t.target).data("value"),this.$(".last-picked").data({value:e}).css({background:"#"+e}),this.trigger("color:picked",e)}},i}(Mercury.ToolbarPalette),JST["/mercury/templates/color"]=function(){var e;return"<ul>\n  "+function(){var i,n,r,o;for(r=t.config("colors").split(" "),o=[],i=0,n=r.length;n>i;i++)e=r[i],o.push("<li data-value='"+e+"' style='background:#"+e+"'></li>");return o}().join("")+'\n  <li class="last-picked">Last Color Picked</li>\n</ul>'}}.call(this),function(){var t,e,i={}.hasOwnProperty,n=function(t,e){function n(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};t=Mercury.registerPlugin("history",{description:"Provides interface for selecting saved versions -- requires server implementation.",version:"1.0.0",registerButton:function(){return this.button.set({type:"history",global:!0,toggle:!0,subview:new t.Panel})}}),t.Panel=function(t){function i(){return e=i.__super__.constructor.apply(this,arguments)}return n(i,t),i.prototype.template="history",i.prototype.className="mercury-history-panel",i.prototype.title="Page Version History",i.prototype.width=250,i.prototype.hidden=!0,i}(Mercury.Panel),JST["/mercury/templates/history"]||(JST["/mercury/templates/history"]=function(){return'<input type="text" class="search-input"/>\n<p>The History Plugin expects a server implementation.</p>\n<p>Since this is a demo, it wasn\'t included, but you can check the <a href="https://github.com/jejacks0n/mercury-rails">mercury-rails project</a> on github for examples of how to integrate it with your server technology.</p>'})}.call(this),function(){var t,e,i={}.hasOwnProperty,n=function(t,e){function n(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};t=Mercury.registerPlugin("link",{description:"Provides interface for inserting and editing links.",version:"1.0.0",actions:{link:"insert"},events:{"mercury:edit:link":"onButtonClick"},registerButton:function(){return this.button.set({type:"link"})},onButtonClick:function(){return this.bindTo(new t.Modal)},bindTo:function(t){var e=this;return t.on("form:submitted",function(t){return e.triggerAction(t)})},insert:function(t,e){return Mercury.trigger("action",t,e)}}),t.Modal=function(t){function i(){return e=i.__super__.constructor.apply(this,arguments)}return n(i,t),i.prototype.template="link",i.prototype.className="mercury-link-modal",i.prototype.title="Link Manager",i.prototype.width=600,i.prototype.elements={text:"#link_text",target:"#link_target"},i.prototype.events={"change .control-label input":"onLabelChecked","focus .controls [name]":"onInputFocused","change #link_target":"onChangeTarget"},i.prototype.onLabelChecked=function(t){var e,i;return e=$(t.target),i=e.closest(".control-label").attr("for"),e.closest(".control-group").find("#"+i).focus()},i.prototype.onInputFocused=function(t){var e;return e=$(t.target),e.closest(".control-group").find("input[type=radio]").prop("checked",!0)},i.prototype.onChangeTarget=function(t){var e;return e=$(t.target),this.$(".link-target-options").hide(),this.$("#"+e.val()+"_options").show(),this.resize(!1)},i.prototype.validate=function(){var t;return i.__super__.validate.apply(this,arguments),t=this.$("#link_"+this.$("input[name=link_type]:checked").val()),t.val()||this.addInputError(t,this.t("can't be blank")),this.$text.is(":visible")&&!this.$text.val().trim()&&this.addInputError(this.$text,this.t("can't be blank")),this.resize(!1)},i.prototype.onSubmit=function(){var t,e,i,n,r;switch(this.validate(),i=this.$text.val(),n=this.$target.val(),r=this.$("input[name=link_type]:checked").val()){case"existing_bookmark":e={url:"#"+this.$("#link_existing_bookmark").val()};break;case"new_bookmark":e={name:""+this.$("#link_new_bookmark").val()};break;default:e={url:this.$("#link_"+r).val()}}switch(n){case"popup":t={width:parseInt(this.$("#link_popup_width").val(),10)||500,height:parseInt(this.$("#link_popup_height").val(),10)||500,menubar:"no",toolbar:"no"},e.url="javascript:void(window.open('"+e.url+"','popup_window','"+Object.toParams(t).replace(/&/g,",")+"'))";break;default:e.target=n||"self"}return e.text=this.content||i,this.trigger("form:submitted",e),this.hide()},i}(Mercury.Modal),JST["/mercury/templates/link"]||(JST["/mercury/templates/link"]=function(){return'<form class="form-horizontal">\n\n  <fieldset class="link_text_container">\n    <div class="control-group string required">\n      <label class="string required control-label" for="link_text">Link Content</label>\n      <div class="controls">\n        <input class="string required" id="link_text" name="link[text]" size="50" type="text" tabindex="1">\n      </div>\n    </div>\n  </fieldset>\n\n  <fieldset>\n    <legend>Standard Links</legend>\n    <div class="control-group url optional">\n      <label class="url optional control-label" for="link_external_url">\n        <input name="link_type" type="radio" value="external_url" checked="checked" tabindex="-1"/>URL\n      </label>\n      <div class="controls">\n        <input class="string url optional" id="link_external_url" name="link[external_url]" size="50" type="text" tabindex="1">\n      </div>\n    </div>\n  </fieldset>\n\n  <fieldset>\n    <legend>Index / Bookmark Links</legend>\n    <div class="control-group select optional">\n      <label class="select optional control-label" for="link_existing_bookmark">\n        <input name="link_type" type="radio" value="existing_bookmark" tabindex="-1"/>Existing Links\n      </label>\n      <div class="controls">\n        <select class="select optional" id="link_existing_bookmark" name="link[existing_bookmark]" tabindex="1"></select>\n      </div>\n    </div>\n    <div class="control-group string optional">\n      <label class="string optional control-label" for="link_new_bookmark">\n        <input name="link_type" type="radio" value="new_bookmark" tabindex="-1"/>Bookmark\n      </label>\n      <div class="controls">\n        <input class="string optional" id="link_new_bookmark" name="link[new_bookmark]" type="text" tabindex="1">\n      </div>\n    </div>\n  </fieldset>\n\n  <fieldset>\n    <legend>Options</legend>\n    <div class="control-group select optional">\n      <label class="select optional control-label" for="link_target">Link Target</label>\n      <div class="controls">\n        <select class="select optional" id="link_target" name="link[target]" tabindex="1">\n          <option value="">Self (the same window or tab)</option>\n          <option value="_blank">Blank (a new window or tab)</option>\n          <option value="_top">Top (removes any frames)</option>\n          <option value="popup">Popup Window (javascript new window popup)</option>\n        </select>\n      </div>\n    </div>\n    <div id="popup_options" class="link-target-options" style="display:none">\n      <div class="control-group number optional">\n        <label class="number optional control-label" for="link_popup_width">Popup Width</label>\n        <div class="controls">\n          <input class="number optional" id="link_popup_width" name="link[popup_width]" type="number" value="960" tabindex="1">\n        </div>\n      </div>\n      <div class="control-group number optional">\n        <label class="number optional control-label" for="link_popup_height">Popup Height</label>\n        <div class="controls">\n          <input class="number optional" id="link_popup_height" name="link[popup_height]" type="number" value="800" tabindex="1">\n        </div>\n      </div>\n    </div>\n  </fieldset>\n\n  <div class="form-actions">\n    <input class="btn btn-primary" name="commit" type="submit" value="Insert Link" tabindex="2">\n  </div>\n</form>'})}.call(this),function(){var t,e,i={}.hasOwnProperty,n=function(t,e){function n(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};t=Mercury.registerPlugin("media",{description:"Provides interface for inserting and editing media.",version:"1.0.0",actions:{image:"insertImage",html:"insertHtml"},events:{"mercury:edit:media":"onButtonClick"},registerButton:function(){return this.button.set({type:"media"})},onButtonClick:function(){return this.bindTo(new t.Modal)},bindTo:function(t){var e=this;return t.on("form:submitted",function(t){return e.triggerAction(t)})},insertImage:function(t,e){return"image"!==e.type?this.insertHtml(t,e):Mercury.trigger("action",t,e)},insertHtml:function(t,e){return e="image"===e.type?'<img src="'+e.src+'"/>':'<iframe src="'+e.src+'" width="'+e.width+'" height="'+e.height+'" frameborder="0" allowFullScreen></iframe>',Mercury.trigger("action","html",e)}}),t.Modal=function(t){function i(){return e=i.__super__.constructor.apply(this,arguments)}return n(i,t),i.prototype.template="media",i.prototype.className="mercury-media-modal",i.prototype.title="Media Manager",i.prototype.width=600,i.prototype.events={"change .control-label input":"onLabelChecked","focus .controls [name]":"onInputFocused"},i.prototype.onLabelChecked=function(t){var e,i;return e=$(t.target),i=e.closest(".control-label").attr("for"),e.closest(".control-group").find("#"+i).focus()},i.prototype.onInputFocused=function(t){var e;return e=$(t.target),e.closest(".control-group").find("input[type=radio]").prop("checked",!0),e.closest(".media-options").length?void 0:(this.$(".media-options").hide(),this.$("#"+e.attr("id").replace("media_","")+"_options").show(),this.resize(!0))},i.prototype.validate=function(){var t,e;if(i.__super__.validate.apply(this,arguments),e=this.$("input[name=media_type]:checked").val(),t=this.$("#media_"+e),t.val())switch(e){case"youtube_url":/^https?:\/\/youtu.be\//.test(t.val())||this.addInputError(t,this.t("Is invalid"));break;case"vimeo_url":/^https?:\/\/youtu.be\//.test(t.val())||this.addInputError(t,this.t("Is invalid"))}else this.addInputError(t,this.t("Can't be blank"));return this.resize(!1)},i.prototype.onSubmit=function(){var t,e,i,n;switch(this.validate(),i=this.$("input[name=media_type]:checked").val(),t=this.$("#media_"+i),n=t.val(),i){case"youtube_url":e={type:"youtube",protocol:/^https:/.test(n)?"https":"http",width:parseInt(this.$("#media_youtube_width").val(),10)||560,height:parseInt(this.$("#media_youtube_height").val(),10)||349,share:n,code:n.replace(/^https?:\/\/youtu.be\//,"")},e.src=""+e.protocol+"://www.youtube-nocookie.com/embed/"+e.code+"?rel=0&wmode=transparent";break;case"vimeo_url":e={type:"vimeo",protocol:/^https:/.test(n)?"https":"http",width:parseInt(this.$("#media_vimeo_width").val(),10)||400,height:parseInt(this.$("#media_vimeo_height").val(),10)||225,share:n,code:n.replace(/^https?:\/\/vimeo.com\//,"")},e.src=""+e.protocol+"://player.vimeo.com/video/"+e.code+"?title=1&byline=1&portrait=0&color=ffffff";
break;default:e={type:"image",protocol:/^https:/.test(n)?"https":"http",src:n,url:n,align:this.$("#media_image_alignment").val(),"float":this.$("#media_image_float").val()}}return this.trigger("form:submitted",e),this.hide()},i}(Mercury.Modal),JST["/mercury/templates/media"]||(JST["/mercury/templates/media"]=function(){return'<form class="form-horizontal">\n\n  <fieldset>\n    <legend>Images</legend>\n    <div class="control-group url optional">\n      <label class="url optional control-label" for="media_image_url">\n        <input name="media_type" type="radio" value="image_url" checked="checked" tabindex="-1"/>URL\n      </label>\n      <div class="controls">\n        <input class="string url optional" id="media_image_url" name="media[image_url]" size="50" type="text" tabindex="1">\n      </div>\n    </div>\n  </fieldset>\n\n  <fieldset>\n    <legend>Videos</legend>\n    <div class="control-group url optional">\n      <label class="url optional control-label" for="media_youtube_url">\n        <input name="media_type" type="radio" value="youtube_url" tabindex="-1"/>YouTube URL\n      </label>\n      <div class="controls">\n        <input class="string url optional" id="media_youtube_url" name="media[youtube_url]" size="50" type="text" placeholder="http://youtu.be/28tZ-S1LFok" tabindex="1">\n      </div>\n    </div>\n    <div class="control-group url optional">\n      <label class="url optional control-label" for="media_vimeo_url">\n        <input name="media_type" type="radio" value="vimeo_url" tabindex="-1"/>Vimeo URL\n      </label>\n      <div class="controls">\n        <input class="string url optional" id="media_vimeo_url" name="media[vimeo_url]" size="50" type="text" placeholder="http://vimeo.com/36684976" tabindex="1">\n      </div>\n    </div>\n  </fieldset>\n\n  <fieldset>\n    <legend>Options</legend>\n\n    <div class="media-options" id="image_url_options">\n      <div class="control-group select optional">\n        <label class="select optional control-label" for="media_image_alignment">Alignment</label>\n        <div class="controls">\n          <select class="select optional" id="media_image_alignment" name="media[image_alignment]" tabindex="1">\n            <option value="">None</option>\n            <option value="left">Left</option>\n            <option value="right">Right</option>\n            <option value="top">Top</option>\n            <option value="middle">Middle</option>\n            <option value="bottom">Bottom</option>\n            <option value="absmiddle">Absolute Middle</option>\n            <option value="absbottom">Absolute Bottom</option>\n          </select>\n        </div>\n      </div>\n      <div class="control-group select optional">\n        <label class="select optional control-label" for="media_image_float">Float</label>\n        <div class="controls">\n          <select class="select optional" id="media_image_float" name="media[image_float]" tabindex="1">\n            <option value="">None</option>\n            <option value="left">Left</option>\n            <option value="right">Right</option>\n            <option value="inherit">Inherit</option>\n          </select>\n        </div>\n      </div>\n    </div>\n\n    <div class="media-options" id="youtube_url_options" style="display:none">\n      <div class="control-group number optional">\n        <label class="number optional control-label" for="media_youtube_width">Width</label>\n        <div class="controls">\n          <input class="number optional" id="media_youtube_width" name="media[youtube_width]" size="50" type="number" value="560" tabindex="1">\n        </div>\n      </div>\n      <div class="control-group number optional">\n        <label class="number optional control-label" for="media_youtube_height">Height</label>\n        <div class="controls">\n          <input class="number optional" id="media_youtube_height" name="media[youtube_height]" size="50" type="number" value="349" tabindex="1">\n        </div>\n      </div>\n    </div>\n\n    <div class="media-options" id="vimeo_url_options" style="display:none">\n      <div class="control-group number optional">\n        <label class="number optional control-label" for="media_vimeo_width">Width</label>\n        <div class="controls">\n          <input class="number optional" id="media_vimeo_width" name="media[vimeo_width]" size="50" type="number" value="400" tabindex="1">\n        </div>\n      </div>\n      <div class="control-group number optional">\n        <label class="number optional control-label" for="media_vimeo_height">Height</label>\n        <div class="controls">\n          <input class="number optional" id="media_vimeo_height" name="media[vimeo_height]" size="50" type="number" value="225" tabindex="1">\n        </div>\n      </div>\n    </div>\n  </fieldset>\n\n  <div class="form-actions">\n    <input class="btn btn-primary" name="commit" type="submit" value="Insert Media" tabindex="2"/>\n  </div>\n</form>'})}.call(this),function(){var t,e,i={}.hasOwnProperty,n=function(t,e){function n(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};t=Mercury.registerPlugin("notes",{description:"Provides interface for reading and adding notes for the page -- requires server implementation.",version:"1.0.0",registerButton:function(){return this.button.set({type:"notes",global:!0,toggle:!0,subview:new t.Panel})}}),t.Panel=function(t){function i(){return e=i.__super__.constructor.apply(this,arguments)}return n(i,t),i.prototype.template="notes",i.prototype.className="mercury-notes-panel",i.prototype.title="Page Notes",i.prototype.width=250,i.prototype.hidden=!0,i}(Mercury.Panel),JST["/mercury/templates/notes"]=function(){return'<p>The Notes Plugin expects a server implementation.</p>\n<p>Since this is a demo, it wasn\'t included, but you can check the <a href="https://github.com/jejacks0n/mercury-rails">mercury-rails project</a> on github for examples of how to integrate it with your server technology.</p>'}}.call(this),function(){var t,e,i={}.hasOwnProperty,n=function(t,e){function n(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};t=Mercury.registerPlugin("snippets",{description:"Provides interface for adding snippets to various regions -- may require server implementation.",version:"1.0.0",config:{toggleOnSnippetRegion:!1},actions:{snippet:"insert"},registerButton:function(){return this.button.set({type:"snippets",global:!0,toggle:!0,subview:this.bindTo(this.panel=new t.Panel)})},bindTo:function(t){var e=this;return t.on("insert:snippet",function(t){return e.triggerAction(t)})},insert:function(t,e){var i;return i=Mercury.getSnippet(e,!0).on("rendered",function(e){return Mercury.trigger("action",t,i,e)}),i.initialize(this.region)},onRegionFocus:function(t){return this.region=t,this.config("toggleOnSnippetRegion")&&this.region!==this.lastRegion?(this.lastRegion=this.region,this.togglePanelByRegion()):void 0},togglePanelByRegion:function(){return this.panel?"snippet"===this.region.type()?(this.panel.visible||(this.shownByRegion=!0),this.panel.show()):this.shownByRegion?(this.panel.hide(),this.shownByRegion=!1):void 0:void 0}}),t.Panel=function(t){function i(){return e=i.__super__.constructor.apply(this,arguments)}return n(i,t),i.prototype.template="snippets",i.prototype.className="mercury-snippets-panel",i.prototype.title="Snippets Panel",i.prototype.width=300,i.prototype.hidden=!0,i.prototype.events={"click input":function(t){return this.trigger("insert:snippet",$(t.target).closest("[data-value]").data("value"))},mousedown:function(){return this.revertInterfaceFocus(),Mercury.trigger("dialogs:hide")}},i.prototype.update=function(){var t;return i.__super__.update.apply(this,arguments),t=this.$("li"),t.on("dragend",function(){return Mercury.dragHack=!1}).on("dragstart",function(t){return Mercury.dragHack=!0,t.originalEvent.dataTransfer.setData("snippet",$(t.target).data("value"))})},i}(Mercury.Panel),JST["/mercury/templates/snippets"]=function(){var t,e,i,n,r;t='<div class="mercury-snippet-actions">Drag or <input type="button" value="Insert" class="btn"></div>',i="<ul>",r=Mercury.Snippet.all();for(e in r)n=r[e],i+='<li data-value="'+e+'">'+n.title+"<em>"+n.description+"</em>"+t+"</li>";return i+"</ul>"}}.call(this),function(){var t,e,i={}.hasOwnProperty,n=function(t,e){function n(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};t=Mercury.registerPlugin("styles",{description:"Provides interface for selecting predefined styles / classes.",version:"1.0.0",prependButtonAction:"insert",actions:{style:"insert",text:"insert"},config:{styles:{red:"Red Text",blue:"Blue Text",highlight:"Highlighted"}},registerButton:function(){return this.button.set({type:"select",subview:this.bindTo(new t.Select)})},bindTo:function(t){var e=this;return t.on("style:picked",function(t){return e.triggerAction(t)})},insert:function(t,e){return Mercury.trigger("action",t,""+e)}}),t.Select=function(t){function i(){return e=i.__super__.constructor.apply(this,arguments)}return n(i,t),i.prototype.template="styles",i.prototype.className="mercury-styles-select",i.prototype.events={"click li":function(t){return this.trigger("style:picked",$(t.target).data("value"))}},i}(Mercury.ToolbarSelect),JST["/mercury/templates/styles"]=function(){var e,i;return"<ul>"+function(){var n,r;n=t.config("styles"),r=[];for(e in n)i=n[e],r.push("<li data-value='"+e+"' class='"+e+"'>"+i+"</li>");return r}().join("")+"</ul>"}}.call(this),function(){var t,e,i={}.hasOwnProperty,n=function(t,e){function n(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};t=Mercury.registerPlugin("table",{description:"Provides interface for inserting and editing tables.",version:"1.0.0",actions:{table:"insertTable"},events:{"mercury:edit:table":"onButtonClick"},registerButton:function(){return this.button.set({type:"table"})},onButtonClick:function(){return this.bindTo(new t.Modal)},bindTo:function(t){var e=this;return t.on("form:submitted",function(t){return e.triggerAction(t)})},insertTable:function(t,e){return Mercury.trigger("action",t,e)}}),t.Modal=function(t){function i(){return e=i.__super__.constructor.apply(this,arguments)}return n(i,t),i.prototype.template="table",i.prototype.className="mercury-table-modal",i.prototype.title="Table Manager",i.prototype.width=600,i.prototype.elements={table:"table"},i.prototype.events={"click table":"onCellClick","click [data-action]":"onActionClick"},i.prototype.update=function(){return i.__super__.update.apply(this,arguments),this.editor=new Mercury.TableEditor(this.$table,"&nbsp;")},i.prototype.onCellClick=function(t){return this.editor.setCell($(t.target))},i.prototype.onActionClick=function(t){return this.prevent(t),this.editor[$(t.target).closest("[data-action]").data("action")]()},i.prototype.onSubmit=function(){return this.trigger("form:submitted",this.editor),this.hide()},i}(Mercury.Modal),JST["/mercury/templates/table"]||(JST["/mercury/templates/table"]=function(){return'<form class="form-horizontal">\n\n  <fieldset class="table-control">\n    <table>\n      <tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>\n      <tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>\n      <tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>\n    </table>\n  </fieldset>\n\n  <fieldset>\n    <div class="control-group buttons optional">\n      <label class="buttons optional control-label">Rows</label>\n      <div class="controls btn-group">\n        <button class="btn" data-action="addRowBefore">Before</button>\n        <button class="btn" data-action="addRowAfter">After</button>\n        <button class="btn" data-action="removeRow">Remove</button>\n      </div>\n    </div>\n    <div class="control-group buttons optional">\n      <label class="buttons optional control-label">Columns</label>\n      <div class="controls btn-group">\n        <button class="btn" data-action="addColumnBefore">Before</button>\n        <button class="btn" data-action="addColumnAfter">After</button>\n        <button class="btn" data-action="removeColumn">Remove</button>\n      </div>\n    </div>\n\n    <hr/>\n\n    <div class="control-group buttons optional">\n      <label class="buttons optional control-label">Row Span</label>\n      <div class="controls btn-group">\n        <button class="btn" data-action="increaseRowspan">+</button>\n        <button class="btn" data-action="decreaseRowspan">-</button>\n      </div>\n    </div>\n    <div class="control-group buttons optional">\n      <label class="buttons optional control-label">Column Span</label>\n      <div class="controls btn-group">\n        <button class="btn" data-action="increaseColspan">+</button>\n        <button class="btn" data-action="decreaseColspan">-</button>\n      </div>\n    </div>\n  </fieldset>\n\n  <fieldset>\n    <legend>Options</legend>\n    <div class="control-group select optional">\n      <label class="select optional control-label" for="table_alignment">Alignment</label>\n      <div class="controls">\n        <select class="select optional" id="table_alignment" name="table[align]">\n          <option value="">None</option>\n          <option value="right">Right</option>\n          <option value="left">Left</option>\n        </select>\n      </div>\n    </div>\n  </fieldset>\n\n  <div class="form-actions">\n    <input class="btn btn-primary" name="commit" type="submit" value="Insert Table"/>\n  </div>\n</form>'})}.call(this);