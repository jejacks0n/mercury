/*!
The HTML region utilizes the full HTML5 ContentEditable featureset and adds some layers on top of that to normalize it
between browsers and to make it nicer to use.

Dependencies:
  rangy-core - https://code.google.com/p/rangy/
  rangy-serializer
  rangy-cssclassapplier
*/
(function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};Mercury.Region.Html=function(e){function n(){try{window.rangy.init()}catch(e){return this.notify(this.t("requires Rangy")),!1}n.__super__.constructor.apply(this,arguments)}return t(n,e),n.define("Mercury.Region.Html","html"),n.include(Mercury.Region.Modules.DropIndicator),n.include(Mercury.Region.Modules.HtmlSelection),n.include(Mercury.Region.Modules.SelectionValue),n.include(Mercury.Region.Modules.ContentEditable),n.supported=Mercury.support.wysiwyg,n.prototype.events={keydown:"onKeyEvent",paste:"onPaste"},n.prototype.onDropFile=function(e,t){var n,r=this;return n=new Mercury.Uploader(e,{mimeTypes:this.config("regions:html:mimeTypes")}),n.on("uploaded",function(e){return r.focus(),r.handleAction("file",e)})},n.prototype.onDropItem=function(){return this.pushHistory()},n.prototype.onPaste=function(e){return console.debug("pasted",e)},n.prototype.onKeyEvent=function(e){if(e.keyCode>=37&&e.keyCode<=40)return;if(e.metaKey&&e.keyCode===90)return;if(e.metaKey)switch(e.keyCode){case 66:return e.preventDefault(),this.handleAction("bold");case 73:return e.preventDefault(),this.handleAction("italic");case 85:return e.preventDefault(),this.handleAction("underline")}return this.pushHistory(e.keyCode)},n}(Mercury.Region),Mercury.Region.Html.addToolbar("html",{defined:{style:["Style",{select:"/mercury/templates/style"}],sep1:" ",block:["Block Format",{select:"/mercury/templates/block"}],sep2:"-"},color:{bgcolor:["Background Color",{palette:"/mercury/templates/bgcolor"}],sep1:" ",color:["Text Color",{palette:"/mercury/templates/color"}],sep2:"-"},decoration:{bold:["Bold"],italic:["Italicize"],strike:["Strikethrough"],underline:["Underline"],sep1:"-"},script:{subscript:["Subscript"],superscript:["Superscript"],sep1:"-"},justify:{justifyLeft:["Align Left"],justifyCenter:["Center"],justifyRight:["Align Right"],justifyFull:["Justify Full"],sep1:"-"},list:{unorderedList:["Unordered List"],orderedList:["Numbered List"],sep1:"-"},indent:{indent:["Increase Indentation"],outdent:["Decrease Indentation"],sep1:"-"},rules:{rule:["Horizontal Rule",{title:"Insert a horizontal rule"}],sep1:"-"},extra:{clean:["Remove Formatting",{title:"Remove formatting for the selection"}],sep1:" ",edit:["Edit HTML",{title:"Edit the HTML content"}],sep2:"-"},table:{rowBefore:["Insert Table Row",{title:"Insert a table row before the cursor"}],rowAfter:["Insert Table Row",{title:"Insert a table row after the cursor"}],rowDelete:["Delete Table Row",{title:"Delete this table row"}],colBefore:["Insert Table Column",{title:"Insert a table column before the cursor"}],colAfter:["Insert Table Column",{title:"Insert a table column after the cursor"}],colDelete:["Delete Table Column",{title:"Delete this table column"}],sep1:" ",colIncrease:["Increase Cell Columns",{title:"Increase the cells colspan"}],colDecrease:["Decrease Cell Columns",{title:"Decrease the cells colspan and add a new cell"}],rowIncrease:["Increase Cell Rows",{title:"Increase the cells rowspan"}],rowDecrease:["Decrease Cell Rows",{title:"Decrease the cells rowspan and add a new cell"}]}}),Mercury.Region.Html.addAction({bold:function(){return this.toggleWrapSelectedWordsInClass("red")},italic:function(){return this.toggleWrapSelectedWordsInClass("highlight")},underline:function(){return this.toggleWrapSelectedWordsInClass("blue")},rule:function(){return this.replaceSelection("<hr/>")}})}).call(this);